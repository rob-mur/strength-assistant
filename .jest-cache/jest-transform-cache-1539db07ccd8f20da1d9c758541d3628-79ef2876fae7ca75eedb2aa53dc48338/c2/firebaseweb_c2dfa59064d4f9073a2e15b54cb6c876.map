{"version":3,"names":["_app","require","_firestore","_firebaseCore","_firebaseWebConfig","_interopRequireDefault","_excluded","_callSuper","t","o","e","_getPrototypeOf2","default","_possibleConstructorReturn2","_isNativeReflectConstruct","Reflect","construct","constructor","apply","Boolean","prototype","valueOf","call","FirebaseWebService","_FirebaseService","_classCallCheck2","_inherits2","_createClass2","key","value","init","initialized","logInfo","startTime","Date","now","operation","config","sanitizeConfig","firebaseConfig","app","initializeApp","db","getFirestore","duration","setupEmulator","error","logError","message","stack","apiKey","safeConfig","_objectWithoutProperties2","Object","assign","slice","isEmulatorEnabled","host","getEmulatorHost","port","emulator","_delegate","_databaseId","database","includes","connectFirestoreEmulator","logWarn","getDb","assertInitialized","Error","dbInstance","getFirebaseApp","isReady","FirebaseService","firebaseService","initFirebase"],"sources":["firebase.web.ts"],"sourcesContent":["import { initializeApp, FirebaseApp } from \"@firebase/app\";\nimport {\n\tconnectFirestoreEmulator,\n\tFirestore,\n\tgetFirestore\n} from \"@firebase/firestore\";\nimport { FirebaseService } from \"./firebase-core\";\nimport firebaseConfig from \"../../../firebase.web.config.json\";\n\nclass FirebaseWebService extends FirebaseService {\n\tprivate app: FirebaseApp | undefined;\n\tprivate db: Firestore | undefined;\n\n\tconstructor() {\n\t\tsuper(\"Firebase\");\n\t}\n\n\tinit(): void {\n\t\tif (this.initialized) {\n\t\t\tthis.logInfo(\"Already initialized, skipping\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst startTime = Date.now();\n\t\tthis.logInfo(\"Initializing Firebase app and Firestore...\", {\n\t\t\toperation: \"init\",\n\t\t\tconfig: this.sanitizeConfig(firebaseConfig)\n\t\t});\n\n\t\ttry {\n\t\t\tthis.app = initializeApp(firebaseConfig);\n\t\t\tthis.db = getFirestore(this.app);\n\n\t\t\tthis.logInfo(\"Firebase app and Firestore initialized successfully\", {\n\t\t\t\toperation: \"init\",\n\t\t\t\tduration: Date.now() - startTime\n\t\t\t});\n\n\t\t\tthis.setupEmulator();\n\t\t\tthis.initialized = true;\n\n\t\t\tthis.logInfo(\"Initialization complete\", {\n\t\t\t\toperation: \"init\",\n\t\t\t\tduration: Date.now() - startTime\n\t\t\t});\n\t\t} catch (error: any) {\n\t\t\tthis.logError(\"Failed to initialize Firebase\", {\n\t\t\t\toperation: \"init\",\n\t\t\t\tduration: Date.now() - startTime,\n\t\t\t\terror: {\n\t\t\t\t\tmessage: error.message,\n\t\t\t\t\tstack: error.stack\n\t\t\t\t}\n\t\t\t});\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tprivate sanitizeConfig(config: any): Record<string, unknown> {\n\t\tconst { apiKey, ...safeConfig } = config;\n\t\treturn {\n\t\t\t...safeConfig,\n\t\t\tapiKey: apiKey ? `${apiKey.slice(0, 8)}...` : 'not-set'\n\t\t};\n\t}\n\n\tprivate setupEmulator(): void {\n\t\tif (!this.db) return;\n\n\t\tif (this.isEmulatorEnabled()) {\n\t\t\tconst host = this.getEmulatorHost();\n\t\t\tconst port = 8080;\n\n\t\t\tthis.logInfo(\"Development mode detected, connecting to emulator\", {\n\t\t\t\toperation: \"emulator_setup\",\n\t\t\t\temulator: { host, port }\n\t\t\t});\n\n\t\t\ttry {\n\t\t\t\t// Check if emulator is already connected\n\t\t\t\tif (!(this.db as any)._delegate?._databaseId?.database?.includes('emulator')) {\n\t\t\t\t\tconnectFirestoreEmulator(this.db, host, port);\n\t\t\t\t\tthis.logInfo(\"Successfully connected to Firestore emulator\", {\n\t\t\t\t\t\toperation: \"emulator_setup\",\n\t\t\t\t\t\temulator: { host, port }\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tthis.logInfo(\"Firestore emulator already connected\", {\n\t\t\t\t\t\toperation: \"emulator_setup\",\n\t\t\t\t\t\temulator: { host, port }\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} catch (error: any) {\n\t\t\t\tthis.logError(\"Failed to connect to emulator\", {\n\t\t\t\t\toperation: \"emulator_setup\",\n\t\t\t\t\temulator: { host, port },\n\t\t\t\t\terror: {\n\t\t\t\t\t\tmessage: error.message\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tthis.logWarn(\"Continuing without emulator for Chrome testing compatibility\");\n\t\t\t}\n\t\t} else {\n\t\t\tthis.logInfo(\"Production mode, using production Firestore\", {\n\t\t\t\toperation: \"emulator_setup\"\n\t\t\t});\n\t\t}\n\t}\n\n\tgetDb(): Firestore {\n\t\tthis.assertInitialized(\"getDb()\");\n\t\tif (!this.db) {\n\t\t\tconst error = new Error(\"Firestore instance not available. This may indicate an initialization timing issue in web environment.\");\n\t\t\tthis.logError(\"getDb() called but Firestore instance is null\", {\n\t\t\t\toperation: \"getDb\",\n\t\t\t\tinitialized: this.initialized,\n\t\t\t\tdbInstance: !!this.db\n\t\t\t});\n\t\t\tthrow error;\n\t\t}\n\t\treturn this.db;\n\t}\n\n\tgetFirebaseApp(): FirebaseApp {\n\t\tthis.assertInitialized(\"getFirebaseApp()\");\n\t\tif (!this.app) {\n\t\t\tthrow new Error(\"Firebase app instance not available\");\n\t\t}\n\t\treturn this.app;\n\t}\n\n\tisReady(): boolean {\n\t\treturn this.initialized && !!this.app && !!this.db;\n\t}\n}\n\nconst firebaseService = new FirebaseWebService();\n\nexport function initFirebase(): void {\n\tfirebaseService.init();\n}\n\nexport function getDb(): Firestore {\n\treturn firebaseService.getDb();\n}\n\nexport function getFirebaseApp(): FirebaseApp {\n\treturn firebaseService.getFirebaseApp();\n}\n\n// Export Firestore functions for modular SDK\nexport { \n\tcollection, \n\tquery, \n\torderBy, \n\tonSnapshot, \n\taddDoc, \n\tdeleteDoc, \n\tdoc \n} from \"@firebase/firestore\";\n"],"mappings":"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","ignoreList":[]}