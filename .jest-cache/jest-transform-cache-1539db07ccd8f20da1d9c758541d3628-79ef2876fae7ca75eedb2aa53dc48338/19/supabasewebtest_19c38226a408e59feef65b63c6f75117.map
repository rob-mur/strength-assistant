{"version":3,"names":["_getJestObj","mock","createClient","jest","fn","virtual","_env2","require","_supabase","_require2","_require","mockCreateClient","originalEnv","process","env","setNodeEnv","value","Object","defineProperty","writable","enumerable","configurable","describe","mockClient","auth","from","storage","beforeEach","clearAllMocks","EXPO_PUBLIC_SUPABASE_URL","EXPO_PUBLIC_SUPABASE_ANON_KEY","EXPO_PUBLIC_USE_SUPABASE_EMULATOR","EXPO_PUBLIC_SUPABASE_EMULATOR_HOST","EXPO_PUBLIC_SUPABASE_EMULATOR_PORT","mockReturnValue","resetSupabaseService","afterEach","afterAll","test","initSupabase","expect","toHaveBeenCalledWith","autoRefreshToken","persistSession","detectSessionInUrl","objectContaining","any","toThrow","toHaveBeenCalledTimes","client","getSupabaseClient","toBe","mockImplementation","Error"],"sources":["supabase-web-test.ts"],"sourcesContent":["import { initSupabase, getSupabaseClient, resetSupabaseService } from \"@/lib/data/supabase/supabase/supabase.web\";\n\n// Mock the Supabase client\njest.mock(\"@supabase/supabase-js\", () => ({\n  createClient: jest.fn(),\n}), { virtual: true });\n\nconst { createClient } = require(\"@supabase/supabase-js\");\nconst mockCreateClient = createClient;\n\n// Mock environment variables\nconst originalEnv = process.env;\n\n// Helper function to set NODE_ENV in Jest environment\nfunction setNodeEnv(value: string) {\n  Object.defineProperty(process.env, 'NODE_ENV', {\n    value,\n    writable: true,\n    enumerable: true,\n    configurable: true\n  });\n}\n\ndescribe(\"SupabaseWebService\", () => {\n  const mockClient = {\n    auth: {},\n    from: jest.fn(),\n    storage: {},\n  };\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    // Clear Supabase environment variables that might interfere with tests\n    delete process.env.EXPO_PUBLIC_SUPABASE_URL;\n    delete process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY;\n    delete process.env.EXPO_PUBLIC_USE_SUPABASE_EMULATOR;\n    delete process.env.EXPO_PUBLIC_SUPABASE_EMULATOR_HOST;\n    delete process.env.EXPO_PUBLIC_SUPABASE_EMULATOR_PORT;\n    mockCreateClient.mockReturnValue(mockClient as any);\n    resetSupabaseService(); // Reset service state for each test\n  });\n\n  afterEach(() => {\n    // Clean up any test-specific environment variables\n    delete process.env.EXPO_PUBLIC_SUPABASE_URL;\n    delete process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY;\n    delete process.env.EXPO_PUBLIC_USE_SUPABASE_EMULATOR;\n    delete process.env.EXPO_PUBLIC_SUPABASE_EMULATOR_HOST;\n    delete process.env.EXPO_PUBLIC_SUPABASE_EMULATOR_PORT;\n  });\n\n  afterAll(() => {\n    process.env = originalEnv;\n  });\n\n  describe(\"initialization\", () => {\n    test(\"initializes with production configuration\", () => {\n      // Set production mode to use explicit URL/key\n      setNodeEnv(\"production\");\n      process.env.EXPO_PUBLIC_SUPABASE_URL = \"https://test.supabase.co\";\n      process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY = \"test-anon-key\";\n      \n      initSupabase();\n      \n      expect(mockCreateClient).toHaveBeenCalledWith(\n        \"https://test.supabase.co\",\n        \"test-anon-key\",\n        {\n          auth: {\n            autoRefreshToken: true,\n            persistSession: true,\n            detectSessionInUrl: true,\n          },\n        }\n      );\n    });\n\n    test(\"initializes with emulator configuration in development\", () => {\n      setNodeEnv(\"development\");\n      process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY = \"dev-anon-key\";\n      \n      initSupabase();\n      \n      expect(mockCreateClient).toHaveBeenCalledWith(\n        \"http://127.0.0.1:54321\",\n        \"dev-anon-key\",\n        expect.objectContaining({\n          auth: expect.objectContaining({\n            autoRefreshToken: true,\n            persistSession: true,\n            detectSessionInUrl: true,\n          }),\n        })\n      );\n    });\n\n    test(\"uses custom emulator host and port\", () => {\n      setNodeEnv(\"development\");\n      process.env.EXPO_PUBLIC_SUPABASE_EMULATOR_HOST = \"localhost\";\n      process.env.EXPO_PUBLIC_SUPABASE_EMULATOR_PORT = \"8000\";\n      process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY = \"dev-anon-key\";\n      \n      initSupabase();\n      \n      expect(mockCreateClient).toHaveBeenCalledWith(\n        \"http://localhost:8000\",\n        \"dev-anon-key\",\n        expect.any(Object)\n      );\n    });\n\n    test(\"uses default development key when no key provided in emulator mode\", () => {\n      setNodeEnv(\"development\");\n      \n      initSupabase();\n      \n      expect(mockCreateClient).toHaveBeenCalledWith(\n        \"http://127.0.0.1:54321\",\n        \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0\",\n        expect.any(Object)\n      );\n    });\n\n    test(\"throws error when missing production URL\", () => {\n      setNodeEnv(\"production\"); // Force production mode\n      process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY = \"test-key\";\n      // No URL set\n      \n      expect(() => initSupabase()).toThrow(\n        \"Missing Supabase configuration. URL: false, Key: true\"\n      );\n    });\n\n    test(\"throws error when missing production anon key\", () => {\n      setNodeEnv(\"production\"); // Force production mode\n      process.env.EXPO_PUBLIC_SUPABASE_URL = \"https://test.supabase.co\";\n      // No anon key set\n      \n      expect(() => initSupabase()).toThrow(\n        \"Missing Supabase configuration. URL: true, Key: false\"\n      );\n    });\n\n    test(\"skips initialization when already initialized\", () => {\n      // Set development mode to enable emulator defaults\n      setNodeEnv(\"development\");\n      process.env.EXPO_PUBLIC_SUPABASE_URL = \"https://test.supabase.co\";\n      process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY = \"test-anon-key\";\n      \n      initSupabase();\n      initSupabase(); // Second call should skip\n      \n      expect(mockCreateClient).toHaveBeenCalledTimes(1);\n    });\n  });\n\n  describe(\"getSupabaseClient\", () => {\n    test(\"returns client after initialization\", () => {\n      // Set development mode to enable emulator defaults\n      setNodeEnv(\"development\");\n      process.env.EXPO_PUBLIC_SUPABASE_URL = \"https://test.supabase.co\";\n      process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY = \"test-anon-key\";\n      \n      initSupabase();\n      const client = getSupabaseClient();\n      \n      expect(client).toBe(mockClient);\n    });\n\n    test(\"throws error when not initialized\", () => {\n      // Service is already reset in beforeEach\n      expect(() => getSupabaseClient()).toThrow(\n        \"Supabase service not initialized. Call init() before getSupabaseClient()\"\n      );\n    });\n  });\n\n  describe(\"error handling\", () => {\n    test(\"handles createClient errors\", () => {\n      setNodeEnv(\"production\"); // Ensure production mode\n      process.env.EXPO_PUBLIC_SUPABASE_URL = \"https://test.supabase.co\";\n      process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY = \"test-anon-key\";\n      \n      mockCreateClient.mockImplementation(() => {\n        throw new Error(\"Connection failed\");\n      });\n      \n      expect(() => initSupabase()).toThrow(\"Connection failed\");\n    });\n  });\n\n  describe(\"emulator detection\", () => {\n    test(\"detects emulator mode with EXPO_PUBLIC_USE_SUPABASE_EMULATOR\", () => {\n      // Use Object.defineProperty to ensure the property is set correctly in Jest\n      Object.defineProperty(process.env, 'EXPO_PUBLIC_USE_SUPABASE_EMULATOR', {\n        value: 'true',\n        writable: true,\n        enumerable: true,\n        configurable: true\n      });\n      // When in emulator mode, service provides default anon key\n      \n      initSupabase();\n      \n      expect(mockCreateClient).toHaveBeenCalledWith(\n        \"http://127.0.0.1:54321\",\n        \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0\",\n        expect.any(Object)\n      );\n    });\n\n    test(\"uses production mode when emulator flag is false\", () => {\n      setNodeEnv(\"production\"); // Explicitly set production mode\n      process.env.EXPO_PUBLIC_USE_SUPABASE_EMULATOR = \"false\";\n      process.env.EXPO_PUBLIC_SUPABASE_URL = \"https://prod.supabase.co\";\n      process.env.EXPO_PUBLIC_SUPABASE_ANON_KEY = \"prod-key\";\n      \n      initSupabase();\n      \n      expect(mockCreateClient).toHaveBeenCalledWith(\n        \"https://prod.supabase.co\",\n        \"prod-key\",\n        expect.any(Object)\n      );\n    });\n  });\n});"],"mappings":"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","ignoreList":[]}