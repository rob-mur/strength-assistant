{"version":3,"names":["Object","defineProperty","exports","value","default","_reactNative","require","_global$expo","LegacyNativeProxy","NativeModules","NativeUnimoduleProxy","ExpoNativeProxy","global","expo","modules","NativeModulesProxy","modulesConstantsKey","exportedMethodsKey","NativeProxy","keys","forEach","moduleName","methodInfo","name","_len","arguments","length","args","Array","_key","callMethod","key","argumentsCount","Promise","reject","Error","EXReactNativeEventEmitter","addListener","_NativeModules$EXReac","_len2","_key2","addProxiedListener","apply","concat","removeListeners","_NativeModules$EXReac2","_len3","_key3","removeProxiedListeners","console","warn","_default"],"sources":["NativeModulesProxy.native.ts"],"sourcesContent":["// Copyright Â© 2024 650 Industries.\n// NOTE: Forcing this to be a client boundary so the errors are a bit clearer. In the future we can\n// make this a shim on the server by ignoring the globals that are missing in React Server contexts (Node.js).\n'use client';\n\nimport { NativeModules } from 'react-native';\n\nimport type { ProxyNativeModule } from './NativeModulesProxy.types';\n\nconst LegacyNativeProxy = NativeModules?.NativeUnimoduleProxy;\n// Fixes `cannot find name 'global'.` in tests\n// @ts-ignore\nconst ExpoNativeProxy = global.expo?.modules?.NativeModulesProxy;\n\nconst modulesConstantsKey = 'modulesConstants';\nconst exportedMethodsKey = 'exportedMethods';\n\n/**\n * @deprecated `NativeModulesProxy` is deprecated and might be removed in the future releases.\n * Use `requireNativeModule` or `requireOptionalNativeModule` instead.\n */\nconst NativeModulesProxy: Record<string, ProxyNativeModule> = {};\n\nif (LegacyNativeProxy) {\n  // use JSI proxy if available, fallback to legacy RN proxy\n  const NativeProxy = ExpoNativeProxy ?? LegacyNativeProxy;\n\n  Object.keys(NativeProxy[exportedMethodsKey]).forEach((moduleName) => {\n    // copy constants\n    NativeModulesProxy[moduleName] = NativeProxy[modulesConstantsKey][moduleName] || {};\n\n    // copy methods\n    // TODO(@kitten): Annotate `NativeProxy` with abstract types to avoid implicit `any`\n    NativeProxy[exportedMethodsKey][moduleName].forEach((methodInfo: any) => {\n      NativeModulesProxy[moduleName][methodInfo.name] = (...args: unknown[]): Promise<any> => {\n        // Use the new proxy to call methods on legacy modules, if possible.\n        if (ExpoNativeProxy?.callMethod) {\n          return ExpoNativeProxy.callMethod(moduleName, methodInfo.name, args);\n        }\n\n        // Otherwise fall back to the legacy proxy.\n        // This is deprecated and might be removed in SDK47 or later.\n        const { key, argumentsCount } = methodInfo;\n        if (argumentsCount !== args.length) {\n          return Promise.reject(\n            new Error(\n              `Native method ${moduleName}.${methodInfo.name} expects ${argumentsCount} ${\n                argumentsCount === 1 ? 'argument' : 'arguments'\n              } but received ${args.length}`\n            )\n          );\n        }\n        return LegacyNativeProxy.callMethod(moduleName, key, args);\n      };\n    });\n\n    // These are called by EventEmitter (which is a wrapper for NativeEventEmitter)\n    // only on iOS, and they use iOS-specific native module, EXReactNativeEventEmitter.\n    //\n    // On Android only {start,stop}Observing are called on the native module\n    // and these should be exported as Expo methods.\n    //\n    // Before the RN 65, addListener/removeListeners weren't called on Android. However, it no longer stays true.\n    // See https://github.com/facebook/react-native/commit/f5502fbda9fe271ff6e1d0da773a3a8ee206a453.\n    // That's why, we check if the `EXReactNativeEventEmitter` exists and only if yes, we use it in the listener implementation.\n    // Otherwise, those methods are NOOP.\n    if (NativeModules.EXReactNativeEventEmitter) {\n      NativeModulesProxy[moduleName].addListener = (...args) =>\n        NativeModules.EXReactNativeEventEmitter.addProxiedListener(moduleName, ...args);\n      NativeModulesProxy[moduleName].removeListeners = (...args) =>\n        NativeModules.EXReactNativeEventEmitter.removeProxiedListeners(moduleName, ...args);\n    } else {\n      // Fixes on Android:\n      // WARN  `new NativeEventEmitter()` was called with a non-null argument without the required `addListener` method.\n      // WARN  `new NativeEventEmitter()` was called with a non-null argument without the required `removeListeners` method.\n      NativeModulesProxy[moduleName].addListener = () => {};\n      NativeModulesProxy[moduleName].removeListeners = () => {};\n    }\n  });\n} else {\n  console.warn(\n    `The \"EXNativeModulesProxy\" native module is not exported through NativeModules; verify that expo-modules-core's native code is linked properly`\n  );\n}\n\nexport default NativeModulesProxy;\n"],"mappings":"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","ignoreList":[]}