appId: com.jimmysolutions.strengthassistant.test
---
# Test: Maestro Built-in Airplane Mode Simulation
# Purpose: Use Maestro's native setAirplaneMode command for automated testing
# 
# ✅ FULLY AUTOMATED - No manual intervention required!
# ✅ Uses Maestro's built-in airplane mode simulation
# ⚠️ Android only - iOS simulators don't support airplane mode

- launchApp

# Handle authentication - continue as guest
- assertVisible:
    text: "Continue as Guest"
- tapOn:
    id: "continue-as-guest"

# Navigate to exercises
- tapOn:
    id: "exercisesTab"
- assertVisible:
    id: "exercisesTab"

# STEP 1: Enable airplane mode using Maestro command
- setAirplaneMode: enabled

# Verify app detects offline state (this automatically waits)
- assertVisible:
    id: "sync-status-offline"

# STEP 2: Create exercises while in airplane mode
- tapOn:
    id: "add-exercise"
- tapOn:
    id: "name"
- inputText: "Maestro Airplane Test 1"
- tapOn:
    id: "submit"

- tapOn:
    id: "add-exercise"
- tapOn:
    id: "name"
- inputText: "Maestro Airplane Test 2"
- tapOn:
    id: "submit"

- tapOn:
    id: "add-exercise"
- tapOn:
    id: "name"
- inputText: "Maestro Airplane Test 3"
- tapOn:
    id: "submit"

# Verify exercises are created locally
- assertVisible:
    text: "Maestro Airplane Test 1"
- assertVisible:
    text: "Maestro Airplane Test 2"
- assertVisible:
    text: "Maestro Airplane Test 3"

# Verify sync status shows pending/offline
- assertVisible:
    id: "sync-status-pending"

# STEP 3: CRITICAL TEST - Restart app while still in airplane mode
- stopApp
- launchApp

# Navigate back to exercises
- tapOn:
    id: "exercisesTab"

# CRITICAL ASSERTION: Exercises must persist through restart in airplane mode
- assertVisible:
    text: "Maestro Airplane Test 1"
- assertVisible:
    text: "Maestro Airplane Test 2"
- assertVisible:
    text: "Maestro Airplane Test 3"

# Should still show offline status
- assertVisible:
    id: "sync-status-offline"

# STEP 4: Disable airplane mode using Maestro command
- setAirplaneMode: disabled

# Verify app detects online state and syncs (this automatically waits)
- assertVisible:
    id: "sync-status-synced"

# Exercises should still be visible after sync
- assertVisible:
    text: "Maestro Airplane Test 1"
- assertVisible:
    text: "Maestro Airplane Test 2"
- assertVisible:
    text: "Maestro Airplane Test 3"

# STEP 5: Final restart test with network available
- stopApp
- launchApp

# Navigate to exercises
- tapOn:
    id: "exercisesTab"

# FINAL CRITICAL ASSERTION: All exercises must survive the complete cycle
- assertVisible:
    text: "Maestro Airplane Test 1"
- assertVisible:
    text: "Maestro Airplane Test 2"
- assertVisible:
    text: "Maestro Airplane Test 3"

# Verify sync status is healthy
- assertVisible:
    id: "sync-status-synced"

# STEP 6: Edge case - Toggle airplane mode multiple times
- setAirplaneMode: enabled
- setAirplaneMode: disabled
- setAirplaneMode: enabled
- setAirplaneMode: disabled

# After rapid toggles, everything should still work
- assertVisible:
    text: "Maestro Airplane Test 1"
- assertVisible:
    text: "Maestro Airplane Test 2"
- assertVisible:
    text: "Maestro Airplane Test 3"
- assertVisible:
    id: "sync-status-synced"

# STEP 7: Test creating exercise after airplane mode cycles
- tapOn:
    id: "add-exercise"
- tapOn:
    id: "name"
- inputText: "Post Airplane Test"
- tapOn:
    id: "submit"

# Should immediately sync since we're online
- assertVisible:
    text: "Post Airplane Test"
- assertVisible:
    id: "sync-status-synced"

# Check for any errors during the test
- assertNotVisible:
    id: "maestro-error-blocker"

# Clean up all test exercises
- tapOn:
    text: "Maestro Airplane Test 1"
- tapOn:
    id: "delete-exercise-button"
- tapOn:
    text: "Delete"

- tapOn:
    id: "exercisesTab"
- tapOn:
    text: "Maestro Airplane Test 2"
- tapOn:
    id: "delete-exercise-button"
- tapOn:
    text: "Delete"

- tapOn:
    id: "exercisesTab"
- tapOn:
    text: "Maestro Airplane Test 3"
- tapOn:
    id: "delete-exercise-button"
- tapOn:
    text: "Delete"

- tapOn:
    id: "exercisesTab"
- tapOn:
    text: "Post Airplane Test"
- tapOn:
    id: "delete-exercise-button"
- tapOn:
    text: "Delete"

# Verify cleanup
- assertNotVisible:
    text: "Maestro Airplane Test 1"
- assertNotVisible:
    text: "Maestro Airplane Test 2"
- assertNotVisible:
    text: "Maestro Airplane Test 3"
- assertNotVisible:
    text: "Post Airplane Test"