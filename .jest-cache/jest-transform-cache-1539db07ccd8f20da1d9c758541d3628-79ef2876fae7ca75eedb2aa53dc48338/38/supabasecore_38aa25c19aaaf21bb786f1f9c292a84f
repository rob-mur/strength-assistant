db2dfee443b6bd0c747c993eb43821aa
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.SupabaseService = void 0;
var _env2 = require("expo/virtual/env");
var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));
var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));
var _supabaseJs = require("@supabase/supabase-js");
var _logger = require("./logger");
var SupabaseService = exports.SupabaseService = function () {
  function SupabaseService(serviceName) {
    (0, _classCallCheck2.default)(this, SupabaseService);
    this.initialized = false;
    this.logger = new _logger.Logger(serviceName);
  }
  return (0, _createClass2.default)(SupabaseService, [{
    key: "logInfo",
    value: function logInfo(message, context) {
      this.logger.info(message, context);
    }
  }, {
    key: "logWarn",
    value: function logWarn(message, context) {
      this.logger.warn(message, context);
    }
  }, {
    key: "logError",
    value: function logError(message, context) {
      this.logger.error(message, context);
    }
  }, {
    key: "assertInitialized",
    value: function assertInitialized(operation) {
      if (!this.initialized) {
        var error = `Supabase service not initialized. Call init() before ${operation}`;
        this.logError(error);
        throw new Error(error);
      }
    }
  }, {
    key: "isEmulatorEnabled",
    value: function isEmulatorEnabled() {
      return process.env.NODE_ENV === "development" || _env2.env.EXPO_PUBLIC_USE_SUPABASE_EMULATOR === "true";
    }
  }, {
    key: "getEmulatorHost",
    value: function getEmulatorHost() {
      return _env2.env.EXPO_PUBLIC_SUPABASE_EMULATOR_HOST || "127.0.0.1";
    }
  }, {
    key: "getEmulatorPort",
    value: function getEmulatorPort() {
      return parseInt(_env2.env.EXPO_PUBLIC_SUPABASE_EMULATOR_PORT || "54321", 10);
    }
  }, {
    key: "getSupabaseUrl",
    value: function getSupabaseUrl() {
      if (this.isEmulatorEnabled()) {
        var host = this.getEmulatorHost();
        var port = this.getEmulatorPort();
        return `http://${host}:${port}`;
      }
      return _env2.env.EXPO_PUBLIC_SUPABASE_URL || "";
    }
  }, {
    key: "getSupabaseAnonKey",
    value: function getSupabaseAnonKey() {
      if (this.isEmulatorEnabled()) {
        return _env2.env.EXPO_PUBLIC_SUPABASE_ANON_KEY || "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0";
      }
      return _env2.env.EXPO_PUBLIC_SUPABASE_ANON_KEY || "";
    }
  }, {
    key: "sanitizeUrl",
    value: function sanitizeUrl(url) {
      try {
        var urlObj = new URL(url);
        return `${urlObj.protocol}//${urlObj.host}`;
      } catch (_unused) {
        return "invalid-url";
      }
    }
  }, {
    key: "createSupabaseClient",
    value: function createSupabaseClient(config) {
      var supabaseUrl = this.getSupabaseUrl();
      var supabaseAnonKey = this.getSupabaseAnonKey();
      this.logInfo("Supabase configuration check", {
        operation: "config_check",
        hasUrl: !!supabaseUrl,
        hasKey: !!supabaseAnonKey,
        emulatorEnabled: this.isEmulatorEnabled(),
        url: this.sanitizeUrl(supabaseUrl),
        emulatorHost: this.getEmulatorHost(),
        emulatorPort: this.getEmulatorPort()
      });
      if (!supabaseUrl || !supabaseAnonKey) {
        var error = `Missing Supabase configuration. URL: ${!!supabaseUrl}, Key: ${!!supabaseAnonKey}`;
        this.logError(error, {
          operation: "config_validation",
          supabaseUrl: supabaseUrl,
          hasAnonKey: !!supabaseAnonKey,
          emulatorEnabled: this.isEmulatorEnabled()
        });
        throw new Error(error);
      }
      this.logInfo("Creating Supabase client", {
        operation: "create_client",
        url: this.sanitizeUrl(supabaseUrl)
      });
      this.client = (0, _supabaseJs.createClient)(supabaseUrl, supabaseAnonKey, {
        auth: {
          autoRefreshToken: true,
          persistSession: true,
          detectSessionInUrl: config.detectSessionInUrl
        }
      });
      this.logInfo("Supabase client created successfully", {
        operation: "client_created"
      });
    }
  }, {
    key: "init",
    value: function init() {
      if (this.initialized) {
        this.logInfo("Already initialized, skipping");
        return;
      }
      var startTime = Date.now();
      this.logInfo(this.getInitMessage(), {
        operation: "init"
      });
      try {
        this.createSupabaseClient(this.getClientConfig());
        this.logInfo("Supabase client initialized successfully", {
          operation: "init",
          duration: Date.now() - startTime,
          url: this.sanitizeUrl(this.getSupabaseUrl())
        });
        this.initialized = true;
        this.logInfo("Initialization complete", {
          operation: "init",
          duration: Date.now() - startTime
        });
      } catch (error) {
        this.logError("Failed to initialize Supabase", {
          operation: "init",
          duration: Date.now() - startTime,
          error: {
            message: error.message,
            stack: error.stack
          }
        });
        throw error;
      }
    }
  }, {
    key: "getSupabaseClient",
    value: function getSupabaseClient() {
      this.assertInitialized("getSupabaseClient()");
      if (!this.client) {
        throw new Error("Supabase client not available");
      }
      return this.client;
    }
  }, {
    key: "isReady",
    value: function isReady() {
      return this.initialized && !!this.client;
    }
  }]);
}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfc3VwYWJhc2VKcyIsInJlcXVpcmUiLCJfbG9nZ2VyIiwiU3VwYWJhc2VTZXJ2aWNlIiwiZXhwb3J0cyIsInNlcnZpY2VOYW1lIiwiX2NsYXNzQ2FsbENoZWNrMiIsImRlZmF1bHQiLCJpbml0aWFsaXplZCIsImxvZ2dlciIsIkxvZ2dlciIsIl9jcmVhdGVDbGFzczIiLCJrZXkiLCJ2YWx1ZSIsImxvZ0luZm8iLCJtZXNzYWdlIiwiY29udGV4dCIsImluZm8iLCJsb2dXYXJuIiwid2FybiIsImxvZ0Vycm9yIiwiZXJyb3IiLCJhc3NlcnRJbml0aWFsaXplZCIsIm9wZXJhdGlvbiIsIkVycm9yIiwiaXNFbXVsYXRvckVuYWJsZWQiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJfZW52MiIsIkVYUE9fUFVCTElDX1VTRV9TVVBBQkFTRV9FTVVMQVRPUiIsImdldEVtdWxhdG9ySG9zdCIsIkVYUE9fUFVCTElDX1NVUEFCQVNFX0VNVUxBVE9SX0hPU1QiLCJnZXRFbXVsYXRvclBvcnQiLCJwYXJzZUludCIsIkVYUE9fUFVCTElDX1NVUEFCQVNFX0VNVUxBVE9SX1BPUlQiLCJnZXRTdXBhYmFzZVVybCIsImhvc3QiLCJwb3J0IiwiRVhQT19QVUJMSUNfU1VQQUJBU0VfVVJMIiwiZ2V0U3VwYWJhc2VBbm9uS2V5IiwiRVhQT19QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJzYW5pdGl6ZVVybCIsInVybCIsInVybE9iaiIsIlVSTCIsInByb3RvY29sIiwiX3VudXNlZCIsImNyZWF0ZVN1cGFiYXNlQ2xpZW50IiwiY29uZmlnIiwic3VwYWJhc2VVcmwiLCJzdXBhYmFzZUFub25LZXkiLCJoYXNVcmwiLCJoYXNLZXkiLCJlbXVsYXRvckVuYWJsZWQiLCJlbXVsYXRvckhvc3QiLCJlbXVsYXRvclBvcnQiLCJoYXNBbm9uS2V5IiwiY2xpZW50IiwiY3JlYXRlQ2xpZW50IiwiYXV0aCIsImF1dG9SZWZyZXNoVG9rZW4iLCJwZXJzaXN0U2Vzc2lvbiIsImRldGVjdFNlc3Npb25JblVybCIsImluaXQiLCJzdGFydFRpbWUiLCJEYXRlIiwibm93IiwiZ2V0SW5pdE1lc3NhZ2UiLCJnZXRDbGllbnRDb25maWciLCJkdXJhdGlvbiIsInN0YWNrIiwiZ2V0U3VwYWJhc2VDbGllbnQiLCJpc1JlYWR5Il0sInNvdXJjZXMiOlsic3VwYWJhc2UtY29yZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQsIFN1cGFiYXNlQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zdXBhYmFzZS1qc1wiO1xuaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tIFwiLi4vLi4vLi4vbW9kZWxzL3N1cGFiYXNlXCI7XG5pbXBvcnQgeyBMb2dnZXIgfSBmcm9tIFwiLi9sb2dnZXJcIjtcblxuLyoqXG4gKiBCYXNlIHNlcnZpY2UgY2xhc3MgZm9yIFN1cGFiYXNlIGltcGxlbWVudGF0aW9ucyBmb2xsb3dpbmcgRmlyZWJhc2UgcGF0dGVyblxuICogUHJvdmlkZXMgY29tbW9uIGZ1bmN0aW9uYWxpdHkgZm9yIHdlYiBhbmQgbmF0aXZlIHBsYXRmb3Jtc1xuICovXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgU3VwYWJhc2VTZXJ2aWNlIHtcblx0cHJvdGVjdGVkIGluaXRpYWxpemVkOiBib29sZWFuID0gZmFsc2U7XG5cdHByb3RlY3RlZCBjbGllbnQ6IFN1cGFiYXNlQ2xpZW50PERhdGFiYXNlPiB8IHVuZGVmaW5lZDtcblx0cHJpdmF0ZSByZWFkb25seSBsb2dnZXI6IExvZ2dlcjtcblxuXHRjb25zdHJ1Y3RvcihzZXJ2aWNlTmFtZTogc3RyaW5nKSB7XG5cdFx0dGhpcy5sb2dnZXIgPSBuZXcgTG9nZ2VyKHNlcnZpY2VOYW1lKTtcblx0fVxuXG5cdHByb3RlY3RlZCBsb2dJbmZvKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IFJlY29yZDxzdHJpbmcsIHVua25vd24+KTogdm9pZCB7XG5cdFx0dGhpcy5sb2dnZXIuaW5mbyhtZXNzYWdlLCBjb250ZXh0KTtcblx0fVxuXG5cdHByb3RlY3RlZCBsb2dXYXJuKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IFJlY29yZDxzdHJpbmcsIHVua25vd24+KTogdm9pZCB7XG5cdFx0dGhpcy5sb2dnZXIud2FybihtZXNzYWdlLCBjb250ZXh0KTtcblx0fVxuXG5cdHByb3RlY3RlZCBsb2dFcnJvcihtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik6IHZvaWQge1xuXHRcdHRoaXMubG9nZ2VyLmVycm9yKG1lc3NhZ2UsIGNvbnRleHQpO1xuXHR9XG5cblx0cHJvdGVjdGVkIGFzc2VydEluaXRpYWxpemVkKG9wZXJhdGlvbjogc3RyaW5nKTogdm9pZCB7XG5cdFx0aWYgKCF0aGlzLmluaXRpYWxpemVkKSB7XG5cdFx0XHRjb25zdCBlcnJvciA9IGBTdXBhYmFzZSBzZXJ2aWNlIG5vdCBpbml0aWFsaXplZC4gQ2FsbCBpbml0KCkgYmVmb3JlICR7b3BlcmF0aW9ufWA7XG5cdFx0XHR0aGlzLmxvZ0Vycm9yKGVycm9yKTtcblx0XHRcdHRocm93IG5ldyBFcnJvcihlcnJvcik7XG5cdFx0fVxuXHR9XG5cblx0cHJvdGVjdGVkIGlzRW11bGF0b3JFbmFibGVkKCk6IGJvb2xlYW4ge1xuXHRcdC8vIENoZWNrIGlmIHdlJ3JlIGluIGRldmVsb3BtZW50IG1vZGUgYW5kIHNob3VsZCB1c2UgbG9jYWwgU3VwYWJhc2Vcblx0XHRyZXR1cm4gKFxuXHRcdFx0cHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09IFwiZGV2ZWxvcG1lbnRcIiB8fFxuXHRcdFx0cHJvY2Vzcy5lbnYuRVhQT19QVUJMSUNfVVNFX1NVUEFCQVNFX0VNVUxBVE9SID09PSBcInRydWVcIlxuXHRcdCk7XG5cdH1cblxuXHRwcm90ZWN0ZWQgZ2V0RW11bGF0b3JIb3N0KCk6IHN0cmluZyB7XG5cdFx0Ly8gRGVmYXVsdCB0byBsb2NhbGhvc3QgZm9yIHdlYiwgYnV0IGFsbG93IG92ZXJyaWRlXG5cdFx0Ly8gTmF0aXZlIGFwcHMgbWlnaHQgbmVlZCBkaWZmZXJlbnQgaG9zdCAoZS5nLiwgMTAuMC4yLjIgZm9yIEFuZHJvaWQgZW11bGF0b3IpXG5cdFx0cmV0dXJuIHByb2Nlc3MuZW52LkVYUE9fUFVCTElDX1NVUEFCQVNFX0VNVUxBVE9SX0hPU1QgfHwgXCIxMjcuMC4wLjFcIjtcblx0fVxuXG5cdHByb3RlY3RlZCBnZXRFbXVsYXRvclBvcnQoKTogbnVtYmVyIHtcblx0XHRyZXR1cm4gcGFyc2VJbnQocHJvY2Vzcy5lbnYuRVhQT19QVUJMSUNfU1VQQUJBU0VfRU1VTEFUT1JfUE9SVCB8fCBcIjU0MzIxXCIsIDEwKTtcblx0fVxuXG5cdHByb3RlY3RlZCBnZXRTdXBhYmFzZVVybCgpOiBzdHJpbmcge1xuXHRcdGlmICh0aGlzLmlzRW11bGF0b3JFbmFibGVkKCkpIHtcblx0XHRcdGNvbnN0IGhvc3QgPSB0aGlzLmdldEVtdWxhdG9ySG9zdCgpO1xuXHRcdFx0Y29uc3QgcG9ydCA9IHRoaXMuZ2V0RW11bGF0b3JQb3J0KCk7XG5cdFx0XHRyZXR1cm4gYGh0dHA6Ly8ke2hvc3R9OiR7cG9ydH1gO1xuXHRcdH1cblxuXHRcdHJldHVybiBwcm9jZXNzLmVudi5FWFBPX1BVQkxJQ19TVVBBQkFTRV9VUkwgfHwgXCJcIjtcblx0fVxuXG5cdHByb3RlY3RlZCBnZXRTdXBhYmFzZUFub25LZXkoKTogc3RyaW5nIHtcblx0XHRpZiAodGhpcy5pc0VtdWxhdG9yRW5hYmxlZCgpKSB7XG5cdFx0XHQvLyBMb2NhbCBTdXBhYmFzZSBoYXMgYSBkZWZhdWx0IGFub24ga2V5IGZvciBkZXZlbG9wbWVudFxuXHRcdFx0cmV0dXJuIHByb2Nlc3MuZW52LkVYUE9fUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIHx8IFwiZXlKaGJHY2lPaUpJVXpJMU5pSXNJblI1Y0NJNklrcFhWQ0o5LmV5SnBjM01pT2lKemRYQmhZbUZ6WlMxa1pXMXZJaXdpY205c1pTSTZJbUZ1YjI0aUxDSmxlSEFpT2pFNU9ETTRNVEk1T1RaOS5DUlhQMUE3V09lb0plWHhqTm5pNDNrZFF3Z25XTlJlaWxETWJsWVRuX0kwXCI7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHByb2Nlc3MuZW52LkVYUE9fUFVCTElDX1NVUEFCQVNFX0FOT05fS0VZIHx8IFwiXCI7XG5cdH1cblxuXHRwcm90ZWN0ZWQgc2FuaXRpemVVcmwodXJsOiBzdHJpbmcpOiBzdHJpbmcge1xuXHRcdC8vIFJlbW92ZSBzZW5zaXRpdmUgaW5mb3JtYXRpb24gZnJvbSBVUkxzIGZvciBsb2dnaW5nXG5cdFx0dHJ5IHtcblx0XHRcdGNvbnN0IHVybE9iaiA9IG5ldyBVUkwodXJsKTtcblx0XHRcdHJldHVybiBgJHt1cmxPYmoucHJvdG9jb2x9Ly8ke3VybE9iai5ob3N0fWA7XG5cdFx0fSBjYXRjaCB7XG5cdFx0XHRyZXR1cm4gXCJpbnZhbGlkLXVybFwiO1xuXHRcdH1cblx0fVxuXG5cdHByb3RlY3RlZCBjcmVhdGVTdXBhYmFzZUNsaWVudChjb25maWc6IHsgZGV0ZWN0U2Vzc2lvbkluVXJsOiBib29sZWFuIH0pOiB2b2lkIHtcblx0XHRjb25zdCBzdXBhYmFzZVVybCA9IHRoaXMuZ2V0U3VwYWJhc2VVcmwoKTtcblx0XHRjb25zdCBzdXBhYmFzZUFub25LZXkgPSB0aGlzLmdldFN1cGFiYXNlQW5vbktleSgpO1xuXG5cdFx0dGhpcy5sb2dJbmZvKFwiU3VwYWJhc2UgY29uZmlndXJhdGlvbiBjaGVja1wiLCB7XG5cdFx0XHRvcGVyYXRpb246IFwiY29uZmlnX2NoZWNrXCIsXG5cdFx0XHRoYXNVcmw6ICEhc3VwYWJhc2VVcmwsXG5cdFx0XHRoYXNLZXk6ICEhc3VwYWJhc2VBbm9uS2V5LFxuXHRcdFx0ZW11bGF0b3JFbmFibGVkOiB0aGlzLmlzRW11bGF0b3JFbmFibGVkKCksXG5cdFx0XHR1cmw6IHRoaXMuc2FuaXRpemVVcmwoc3VwYWJhc2VVcmwpLFxuXHRcdFx0ZW11bGF0b3JIb3N0OiB0aGlzLmdldEVtdWxhdG9ySG9zdCgpLFxuXHRcdFx0ZW11bGF0b3JQb3J0OiB0aGlzLmdldEVtdWxhdG9yUG9ydCgpXG5cdFx0fSk7XG5cblx0XHRpZiAoIXN1cGFiYXNlVXJsIHx8ICFzdXBhYmFzZUFub25LZXkpIHtcblx0XHRcdGNvbnN0IGVycm9yID0gYE1pc3NpbmcgU3VwYWJhc2UgY29uZmlndXJhdGlvbi4gVVJMOiAkeyEhc3VwYWJhc2VVcmx9LCBLZXk6ICR7ISFzdXBhYmFzZUFub25LZXl9YDtcblx0XHRcdHRoaXMubG9nRXJyb3IoZXJyb3IsIHtcblx0XHRcdFx0b3BlcmF0aW9uOiBcImNvbmZpZ192YWxpZGF0aW9uXCIsXG5cdFx0XHRcdHN1cGFiYXNlVXJsLFxuXHRcdFx0XHRoYXNBbm9uS2V5OiAhIXN1cGFiYXNlQW5vbktleSxcblx0XHRcdFx0ZW11bGF0b3JFbmFibGVkOiB0aGlzLmlzRW11bGF0b3JFbmFibGVkKClcblx0XHRcdH0pO1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKGVycm9yKTtcblx0XHR9XG5cblx0XHR0aGlzLmxvZ0luZm8oXCJDcmVhdGluZyBTdXBhYmFzZSBjbGllbnRcIiwge1xuXHRcdFx0b3BlcmF0aW9uOiBcImNyZWF0ZV9jbGllbnRcIixcblx0XHRcdHVybDogdGhpcy5zYW5pdGl6ZVVybChzdXBhYmFzZVVybClcblx0XHR9KTtcblxuXHRcdHRoaXMuY2xpZW50ID0gY3JlYXRlQ2xpZW50PERhdGFiYXNlPihzdXBhYmFzZVVybCwgc3VwYWJhc2VBbm9uS2V5LCB7XG5cdFx0XHRhdXRoOiB7XG5cdFx0XHRcdGF1dG9SZWZyZXNoVG9rZW46IHRydWUsXG5cdFx0XHRcdHBlcnNpc3RTZXNzaW9uOiB0cnVlLFxuXHRcdFx0XHRkZXRlY3RTZXNzaW9uSW5Vcmw6IGNvbmZpZy5kZXRlY3RTZXNzaW9uSW5VcmwsXG5cdFx0XHR9LFxuXHRcdH0pO1xuXG5cdFx0dGhpcy5sb2dJbmZvKFwiU3VwYWJhc2UgY2xpZW50IGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5XCIsIHtcblx0XHRcdG9wZXJhdGlvbjogXCJjbGllbnRfY3JlYXRlZFwiXG5cdFx0fSk7XG5cdH1cblxuXHQvKipcblx0ICogR2V0IHBsYXRmb3JtLXNwZWNpZmljIGNsaWVudCBjb25maWd1cmF0aW9uXG5cdCAqL1xuXHRwcm90ZWN0ZWQgYWJzdHJhY3QgZ2V0Q2xpZW50Q29uZmlnKCk6IHsgZGV0ZWN0U2Vzc2lvbkluVXJsOiBib29sZWFuIH07XG5cblx0LyoqXG5cdCAqIEluaXRpYWxpemUgdGhlIFN1cGFiYXNlIHNlcnZpY2Vcblx0ICovXG5cdGluaXQoKTogdm9pZCB7XG5cdFx0aWYgKHRoaXMuaW5pdGlhbGl6ZWQpIHtcblx0XHRcdHRoaXMubG9nSW5mbyhcIkFscmVhZHkgaW5pdGlhbGl6ZWQsIHNraXBwaW5nXCIpO1xuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG5cdFx0dGhpcy5sb2dJbmZvKHRoaXMuZ2V0SW5pdE1lc3NhZ2UoKSwge1xuXHRcdFx0b3BlcmF0aW9uOiBcImluaXRcIixcblx0XHR9KTtcblxuXHRcdHRyeSB7XG5cdFx0XHR0aGlzLmNyZWF0ZVN1cGFiYXNlQ2xpZW50KHRoaXMuZ2V0Q2xpZW50Q29uZmlnKCkpO1xuXG5cdFx0XHR0aGlzLmxvZ0luZm8oXCJTdXBhYmFzZSBjbGllbnQgaW5pdGlhbGl6ZWQgc3VjY2Vzc2Z1bGx5XCIsIHtcblx0XHRcdFx0b3BlcmF0aW9uOiBcImluaXRcIixcblx0XHRcdFx0ZHVyYXRpb246IERhdGUubm93KCkgLSBzdGFydFRpbWUsXG5cdFx0XHRcdHVybDogdGhpcy5zYW5pdGl6ZVVybCh0aGlzLmdldFN1cGFiYXNlVXJsKCkpLFxuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXG5cdFx0XHR0aGlzLmxvZ0luZm8oXCJJbml0aWFsaXphdGlvbiBjb21wbGV0ZVwiLCB7XG5cdFx0XHRcdG9wZXJhdGlvbjogXCJpbml0XCIsXG5cdFx0XHRcdGR1cmF0aW9uOiBEYXRlLm5vdygpIC0gc3RhcnRUaW1lLFxuXHRcdFx0fSk7XG5cdFx0fSBjYXRjaCAoZXJyb3I6IGFueSkge1xuXHRcdFx0dGhpcy5sb2dFcnJvcihcIkZhaWxlZCB0byBpbml0aWFsaXplIFN1cGFiYXNlXCIsIHtcblx0XHRcdFx0b3BlcmF0aW9uOiBcImluaXRcIixcblx0XHRcdFx0ZHVyYXRpb246IERhdGUubm93KCkgLSBzdGFydFRpbWUsXG5cdFx0XHRcdGVycm9yOiB7XG5cdFx0XHRcdFx0bWVzc2FnZTogZXJyb3IubWVzc2FnZSxcblx0XHRcdFx0XHRzdGFjazogZXJyb3Iuc3RhY2ssXG5cdFx0XHRcdH0sXG5cdFx0XHR9KTtcblx0XHRcdHRocm93IGVycm9yO1xuXHRcdH1cblx0fVxuXG5cdC8qKlxuXHQgKiBHZXQgcGxhdGZvcm0tc3BlY2lmaWMgaW5pdGlhbGl6YXRpb24gbWVzc2FnZVxuXHQgKi9cblx0cHJvdGVjdGVkIGFic3RyYWN0IGdldEluaXRNZXNzYWdlKCk6IHN0cmluZztcblxuXHQvKipcblx0ICogR2V0IHRoZSBTdXBhYmFzZSBjbGllbnQgaW5zdGFuY2Vcblx0ICovXG5cdGdldFN1cGFiYXNlQ2xpZW50KCk6IFN1cGFiYXNlQ2xpZW50PERhdGFiYXNlPiB7XG5cdFx0dGhpcy5hc3NlcnRJbml0aWFsaXplZChcImdldFN1cGFiYXNlQ2xpZW50KClcIik7XG5cdFx0aWYgKCF0aGlzLmNsaWVudCkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFwiU3VwYWJhc2UgY2xpZW50IG5vdCBhdmFpbGFibGVcIik7XG5cdFx0fVxuXHRcdHJldHVybiB0aGlzLmNsaWVudDtcblx0fVxuXG5cdC8qKlxuXHQgKiBDaGVjayBpZiB0aGUgc2VydmljZSBpcyByZWFkeSBmb3IgdXNlXG5cdCAqL1xuXHRpc1JlYWR5KCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiB0aGlzLmluaXRpYWxpemVkICYmICEhdGhpcy5jbGllbnQ7XG5cdH1cbn1cbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQSxJQUFBQSxXQUFBLEdBQUFDLE9BQUE7QUFFQSxJQUFBQyxPQUFBLEdBQUFELE9BQUE7QUFBa0MsSUFNWkUsZUFBZSxHQUFBQyxPQUFBLENBQUFELGVB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