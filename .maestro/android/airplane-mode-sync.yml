appId: com.jimmysolutions.strengthassistant.test
---
# Test: Maestro Built-in Airplane Mode Simulation
# Purpose: Use Maestro's native setAirplaneMode command for automated testing
# 
# ✅ FULLY AUTOMATED - No manual intervention required!
# ✅ Uses Maestro's built-in airplane mode simulation
# ⚠️ Android only - iOS simulators don't support airplane mode

- launchApp

# Handle authentication and onboarding
- runFlow:
    file: ../shared/common/auth-flow.yml

# Navigate to exercises
- runFlow:
    file: ../shared/common/navigate-to-exercises.yml

# STEP 1: Enable airplane mode using Maestro command
- setAirplaneMode: enabled

# Verify app detects offline state (this automatically waits)
- runFlow:
    file: ../shared/common/sync-status-check.yml
    env:
      EXPECTED_STATUS: "offline"

# STEP 2: Create exercises while in airplane mode
- runFlow:
    file: ../shared/common/create-multiple-exercises.yml
    env:
      EXERCISE_PREFIX: "Maestro Airplane Test"

# Verify exercises are created locally
- assertVisible:
    text: "Maestro Airplane Test 1"
- assertVisible:
    text: "Maestro Airplane Test 2"
- assertVisible:
    text: "Maestro Airplane Test 3"

# Verify sync status shows pending/offline
- runFlow:
    file: ../shared/common/sync-status-check.yml
    env:
      EXPECTED_STATUS: "pending"

# STEP 3: CRITICAL TEST - Restart app while still in airplane mode
- stopApp
- launchApp

# Navigate back to exercises
- runFlow:
    file: ../shared/common/navigate-to-exercises.yml

# CRITICAL ASSERTION: Exercises must persist through restart in airplane mode
- assertVisible:
    text: "Maestro Airplane Test 1"
- assertVisible:
    text: "Maestro Airplane Test 2"
- assertVisible:
    text: "Maestro Airplane Test 3"

# Should still show offline status
- runFlow:
    file: ../shared/common/sync-status-check.yml
    env:
      EXPECTED_STATUS: "offline"

# STEP 4: Disable airplane mode using Maestro command
- setAirplaneMode: disabled

# Verify app detects online state and syncs (this automatically waits)
- runFlow:
    file: ../shared/common/sync-status-check.yml
    env:
      EXPECTED_STATUS: "synced"

# Exercises should still be visible after sync
- assertVisible:
    text: "Maestro Airplane Test 1"
- assertVisible:
    text: "Maestro Airplane Test 2"
- assertVisible:
    text: "Maestro Airplane Test 3"

# STEP 5: Final restart test with network available
- stopApp
- launchApp

# Navigate to exercises
- runFlow:
    file: ../shared/common/navigate-to-exercises.yml

# FINAL CRITICAL ASSERTION: All exercises must survive the complete cycle
- assertVisible:
    text: "Maestro Airplane Test 1"
- assertVisible:
    text: "Maestro Airplane Test 2"
- assertVisible:
    text: "Maestro Airplane Test 3"

# Verify sync status is healthy
- runFlow:
    file: ../shared/common/sync-status-check.yml
    env:
      EXPECTED_STATUS: "synced"

# STEP 6: Edge case - Toggle airplane mode multiple times
- setAirplaneMode: enabled
- setAirplaneMode: disabled
- setAirplaneMode: enabled
- setAirplaneMode: disabled

# After rapid toggles, everything should still work
- assertVisible:
    text: "Maestro Airplane Test 1"
- assertVisible:
    text: "Maestro Airplane Test 2"
- assertVisible:
    text: "Maestro Airplane Test 3"
- runFlow:
    file: ../shared/common/sync-status-check.yml
    env:
      EXPECTED_STATUS: "synced"

# STEP 7: Test creating exercise after airplane mode cycles
- runFlow:
    file: ../shared/common/add-exercise.yml
    env:
      EXERCISE_NAME: "Post Airplane Test"

# Should immediately sync since we're online
- runFlow:
    file: ../shared/common/navigate-to-exercises.yml
- assertVisible:
    text: "Post Airplane Test"
- runFlow:
    file: ../shared/common/sync-status-check.yml
    env:
      EXPECTED_STATUS: "synced"

# Check for any errors during the test
- runFlow:
    file: ../shared/common/error-check.yml

# Clean up all test exercises
- runFlow:
    file: ../shared/common/delete-exercise.yml
    env:
      EXERCISE_NAME: "Maestro Airplane Test 1"

- runFlow:
    file: ../shared/common/delete-exercise.yml
    env:
      EXERCISE_NAME: "Maestro Airplane Test 2"

- runFlow:
    file: ../shared/common/delete-exercise.yml
    env:
      EXERCISE_NAME: "Maestro Airplane Test 3"

- runFlow:
    file: ../shared/common/delete-exercise.yml
    env:
      EXERCISE_NAME: "Post Airplane Test"

# Verify cleanup
- assertNotVisible:
    text: "Maestro Airplane Test 1"
- assertNotVisible:
    text: "Maestro Airplane Test 2"
- assertNotVisible:
    text: "Maestro Airplane Test 3"
- assertNotVisible:
    text: "Post Airplane Test"