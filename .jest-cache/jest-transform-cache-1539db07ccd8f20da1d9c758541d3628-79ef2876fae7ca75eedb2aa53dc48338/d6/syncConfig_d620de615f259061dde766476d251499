5ecb7b6e00d88a9b66f0fe8d05a31d3e
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.configureSyncEngine = configureSyncEngine;
exports.deleteExerciseFromSupabase = deleteExerciseFromSupabase;
exports.syncExerciseToSupabase = syncExerciseToSupabase;
exports.syncHelpers = void 0;
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _SupabaseClient = require("../supabase/SupabaseClient");
var _store = require("../store");
var _SYNC_RETRY_DELAY = 1000;
var _SYNC_TIMEOUT = 30000;
var _NETWORK_CHECK_INTERVAL = 5000;
function configureSyncEngine() {
  loadInitialData();
  setupRealtimeSubscription();
}
function loadInitialData() {
  return _loadInitialData.apply(this, arguments);
}
function _loadInitialData() {
  _loadInitialData = (0, _asyncToGenerator2.default)(function* () {
    try {
      var user = yield _SupabaseClient.supabaseClient.getCurrentUser();
      if (!user) return;
      var _yield$select$eq2 = yield _SupabaseClient.supabaseClient.getSupabaseClient().from('exercises').select('*').eq('user_id', user.id),
        data = _yield$select$eq2.data,
        error = _yield$select$eq2.error;
      if (error) throw error;
      _store.exercises$.set(data || []);
    } catch (error) {
      console.error('Failed to load initial exercises:', error);
    }
  });
  return _loadInitialData.apply(this, arguments);
}
function setupRealtimeSubscription() {
  var subscription = null;
  var startSubscription = function () {
    var _ref = (0, _asyncToGenerator2.default)(function* () {
      try {
        var user = yield _SupabaseClient.supabaseClient.getCurrentUser();
        if (!user) return;
        subscription = _SupabaseClient.supabaseClient.getSupabaseClient().channel('exercises').on('postgres_changes', {
          event: '*',
          schema: 'public',
          table: 'exercises',
          filter: `user_id=eq.${user.id}`
        }, function (payload) {
          var currentExercises = _store.exercises$.get();
          if (payload.eventType === 'INSERT') {
            var newExercise = payload.new;
            if (newExercise.user_id === user.id) {
              _store.exercises$.push(newExercise);
            }
          } else if (payload.eventType === 'DELETE') {
            var deletedExercise = payload.old;
            var indexToDelete = currentExercises.findIndex(function (ex) {
              return ex.id === deletedExercise.id;
            });
            if (indexToDelete !== -1) {
              _store.exercises$.splice(indexToDelete, 1);
            }
          } else if (payload.eventType === 'UPDATE') {
            var updatedExercise = payload.new;
            if (updatedExercise.user_id === user.id) {
              var indexToUpdate = currentExercises.findIndex(function (ex) {
                return ex.id === updatedExercise.id;
              });
              if (indexToUpdate !== -1) {
                _store.exercises$[indexToUpdate].set(updatedExercise);
              }
            }
          }
        }).subscribe();
      } catch (error) {
        console.error('Failed to set up real-time subscription:', error);
      }
    });
    return function startSubscription() {
      return _ref.apply(this, arguments);
    };
  }();
  _SupabaseClient.supabaseClient.onAuthStateChange(function (event, session) {
    _store.user$.set((session == null ? void 0 : session.user) || null);
    if (subscription) {
      subscription.unsubscribe();
      subscription = null;
    }
    if (session != null && session.user) {
      startSubscription();
      loadInitialData();
    } else {
      _store.exercises$.set([]);
    }
  });
}
function syncExerciseToSupabase(_x) {
  return _syncExerciseToSupabase.apply(this, arguments);
}
function _syncExerciseToSupabase() {
  _syncExerciseToSupabase = (0, _asyncToGenerator2.default)(function* (exercise) {
    try {
      var user = yield _SupabaseClient.supabaseClient.getCurrentUser();
      if (!user) throw new Error('User not authenticated');
      var exerciseToUpsert = {
        id: exercise.id,
        name: exercise.name,
        user_id: exercise.user_id,
        created_at: exercise.created_at
      };
      var _yield$upsert = yield _SupabaseClient.supabaseClient.getSupabaseClient().from('exercises').upsert(exerciseToUpsert),
        error = _yield$upsert.error;
      if (error) throw error;
    } catch (error) {
      console.error('Failed to sync exercise to Supabase:', error);
      throw error;
    }
  });
  return _syncExerciseToSupabase.apply(this, arguments);
}
function deleteExerciseFromSupabase(_x2, _x3) {
  return _deleteExerciseFromSupabase.apply(this, arguments);
}
function _deleteExerciseFromSupabase() {
  _deleteExerciseFromSupabase = (0, _asyncToGenerator2.default)(function* (exerciseId, userId) {
    try {
      var _yield$delete$eq$eq = yield _SupabaseClient.supabaseClient.getSupabaseClient().from('exercises').delete().eq('id', exerciseId).eq('user_id', userId),
        error = _yield$delete$eq$eq.error;
      if (error) throw error;
    } catch (error) {
      console.error('Failed to delete exercise from Supabase:', error);
      throw error;
    }
  });
  return _deleteExerciseFromSupabase.apply(this, arguments);
}
var syncHelpers = exports.syncHelpers = {
  forceSync: function () {
    var _forceSync = (0, _asyncToGenerator2.default)(function* () {
      try {
        var user = yield _SupabaseClient.supabaseClient.getCurrentUser();
        if (!user) return;
        var _yield$select$eq = yield _SupabaseClient.supabaseClient.getSupabaseClient().from('exercises').select('*').eq('user_id', user.id),
          data = _yield$select$eq.data,
          error = _yield$select$eq.error;
        if (!error && data) {
          _store.exercises$.set(data);
        }
      } catch (error) {
        console.error('Failed to force sync:', error);
      }
    });
    function forceSync() {
      return _forceSync.apply(this, arguments);
    }
    return forceSync;
  }(),
  isSyncing: function isSyncing() {
    return false;
  },
  isOnline: function isOnline() {
    if (typeof navigator !== 'undefined' && 'onLine' in navigator) {
      return navigator.onLine;
    }
    return true;
  },
  getPendingChangesCount: function getPendingChangesCount() {
    return 0;
  },
  hasErrors: function hasErrors() {
    return false;
  },
  getErrorMessage: function getErrorMessage() {
    return undefined;
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfU3VwYWJhc2VDbGllbnQiLCJyZXF1aXJlIiwiX3N0b3JlIiwiX1NZTkNfUkVUUllfREVMQVkiLCJfU1lOQ19USU1FT1VUIiwiX05FVFdPUktfQ0hFQ0tfSU5URVJWQUwiLCJjb25maWd1cmVTeW5jRW5naW5lIiwibG9hZEluaXRpYWxEYXRhIiwic2V0dXBSZWFsdGltZVN1YnNjcmlwdGlvbiIsIl9sb2FkSW5pdGlhbERhdGEiLCJhcHBseSIsImFyZ3VtZW50cyIsIl9hc3luY1RvR2VuZXJhdG9yMiIsImRlZmF1bHQiLCJ1c2VyIiwic3VwYWJhc2VDbGllbnQiLCJnZXRDdXJyZW50VXNlciIsIl95aWVsZCRzZWxlY3QkZXEyIiwiZ2V0U3VwYWJhc2VDbGllbnQiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJpZCIsImRhdGEiLCJlcnJvciIsImV4ZXJjaXNlcyQiLCJzZXQiLCJjb25zb2xlIiwic3Vic2NyaXB0aW9uIiwic3RhcnRTdWJzY3JpcHRpb24iLCJfcmVmIiwiY2hhbm5lbCIsIm9uIiwiZXZlbnQiLCJzY2hlbWEiLCJ0YWJsZSIsImZpbHRlciIsInBheWxvYWQiLCJjdXJyZW50RXhlcmNpc2VzIiwiZ2V0IiwiZXZlbnRUeXBlIiwibmV3RXhlcmNpc2UiLCJuZXciLCJ1c2VyX2lkIiwicHVzaCIsImRlbGV0ZWRFeGVyY2lzZSIsIm9sZCIsImluZGV4VG9EZWxldGUiLCJmaW5kSW5kZXgiLCJleCIsInNwbGljZSIsInVwZGF0ZWRFeGVyY2lzZSIsImluZGV4VG9VcGRhdGUiLCJzdWJzY3JpYmUiLCJvbkF1dGhTdGF0ZUNoYW5nZSIsInNlc3Npb24iLCJ1c2VyJCIsInVuc3Vic2NyaWJlIiwic3luY0V4ZXJjaXNlVG9TdXBhYmFzZSIsIl94IiwiX3N5bmNFeGVyY2lzZVRvU3VwYWJhc2UiLCJleGVyY2lzZSIsIkVycm9yIiwiZXhlcmNpc2VUb1Vwc2VydCIsIm5hbWUiLCJjcmVhdGVkX2F0IiwiX3lpZWxkJHVwc2VydCIsInVwc2VydCIsImRlbGV0ZUV4ZXJjaXNlRnJvbVN1cGFiYXNlIiwiX3gyIiwiX3gzIiwiX2RlbGV0ZUV4ZXJjaXNlRnJvbVN1cGFiYXNlIiwiZXhlcmNpc2VJZCIsInVzZXJJZCIsIl95aWVsZCRkZWxldGUkZXEkZXEiLCJkZWxldGUiLCJzeW5jSGVscGVycyIsImV4cG9ydHMiLCJmb3JjZVN5bmMiLCJfZm9yY2VTeW5jIiwiX3lpZWxkJHNlbGVjdCRlcSIsImlzU3luY2luZyIsImlzT25saW5lIiwibmF2aWdhdG9yIiwib25MaW5lIiwiZ2V0UGVuZGluZ0NoYW5nZXNDb3VudCIsImhhc0Vycm9ycyIsImdldEVycm9yTWVzc2FnZSIsInVuZGVmaW5lZCJdLCJzb3VyY2VzIjpbInN5bmNDb25maWcudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgc3VwYWJhc2VDbGllbnQgfSBmcm9tICcuLi9zdXBhYmFzZS9TdXBhYmFzZUNsaWVudCc7XG5pbXBvcnQgeyBleGVyY2lzZXMkLCB1c2VyJCB9IGZyb20gJy4uL3N0b3JlJztcbmltcG9ydCB7IEV4ZXJjaXNlIH0gZnJvbSAnLi4vLi4vbW9kZWxzL0V4ZXJjaXNlJztcbmltcG9ydCB7IEV4ZXJjaXNlSW5zZXJ0IH0gZnJvbSAnLi4vLi4vbW9kZWxzL3N1cGFiYXNlJztcblxuLy8gU3luYyBjb25maWd1cmF0aW9uIGNvbnN0YW50c1xuY29uc3QgX1NZTkNfUkVUUllfREVMQVkgPSAxMDAwOyAvLyAxIHNlY29uZFxuY29uc3QgX1NZTkNfVElNRU9VVCA9IDMwMDAwOyAvLyAzMCBzZWNvbmRzXG5jb25zdCBfTkVUV09SS19DSEVDS19JTlRFUlZBTCA9IDUwMDA7IC8vIDUgc2Vjb25kc1xuXG4vKipcbiAqIENvbmZpZ3VyYXRpb24gZm9yIExlZ2VuZCBTdGF0ZSBzeW5jIHdpdGggU3VwYWJhc2VcbiAqIFByb3ZpZGVzIG9mZmxpbmUtZmlyc3QgZGF0YSBzeW5jaHJvbml6YXRpb24gd2l0aCBhdXRvbWF0aWMgY29uZmxpY3QgcmVzb2x1dGlvblxuICovXG5leHBvcnQgZnVuY3Rpb24gY29uZmlndXJlU3luY0VuZ2luZSgpIHtcblx0Ly8gSW5pdGlhbGl6ZSB3aXRoIGRhdGEgbG9hZGluZyBhbmQgcmVhbC10aW1lIHN1YnNjcmlwdGlvblxuXHRsb2FkSW5pdGlhbERhdGEoKTtcblx0c2V0dXBSZWFsdGltZVN1YnNjcmlwdGlvbigpO1xufVxuXG4vKipcbiAqIExvYWQgaW5pdGlhbCBleGVyY2lzZXMgZGF0YSBmcm9tIFN1cGFiYXNlXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGxvYWRJbml0aWFsRGF0YSgpIHtcblx0dHJ5IHtcblx0XHRjb25zdCB1c2VyID0gYXdhaXQgc3VwYWJhc2VDbGllbnQuZ2V0Q3VycmVudFVzZXIoKTtcblx0XHRpZiAoIXVzZXIpIHJldHVybjtcblxuXHRcdGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IChzdXBhYmFzZUNsaWVudC5nZXRTdXBhYmFzZUNsaWVudCgpLmZyb20oJ2V4ZXJjaXNlcycpIGFzIGFueSlcblx0XHRcdC5zZWxlY3QoJyonKVxuXHRcdFx0LmVxKCd1c2VyX2lkJywgdXNlci5pZCk7XG5cblx0XHRpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuXHRcdGV4ZXJjaXNlcyQuc2V0KGRhdGEgfHwgW10pO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBsb2FkIGluaXRpYWwgZXhlcmNpc2VzOicsIGVycm9yKTtcblx0fVxufVxuXG4vKipcbiAqIFNldCB1cCByZWFsLXRpbWUgc3Vic2NyaXB0aW9uIGZvciBleGVyY2lzZXNcbiAqL1xuZnVuY3Rpb24gc2V0dXBSZWFsdGltZVN1YnNjcmlwdGlvbigpIHtcblx0bGV0IHN1YnNjcmlwdGlvbjogYW55ID0gbnVsbDtcblxuXHRjb25zdCBzdGFydFN1YnNjcmlwdGlvbiA9IGFzeW5jICgpID0+IHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgdXNlciA9IGF3YWl0IHN1cGFiYXNlQ2xpZW50LmdldEN1cnJlbnRVc2VyKCk7XG5cdFx0XHRpZiAoIXVzZXIpIHJldHVybjtcblxuXHRcdFx0c3Vic2NyaXB0aW9uID0gc3VwYWJhc2VDbGllbnQuZ2V0U3VwYWJhc2VDbGllbnQoKVxuXHRcdFx0XHQuY2hhbm5lbCgnZXhlcmNpc2VzJylcblx0XHRcdFx0Lm9uKCdwb3N0Z3Jlc19jaGFuZ2VzJywge1xuXHRcdFx0XHRcdGV2ZW50OiAnKicsXG5cdFx0XHRcdFx0c2NoZW1hOiAncHVibGljJyxcblx0XHRcdFx0XHR0YWJsZTogJ2V4ZXJjaXNlcycsXG5cdFx0XHRcdFx0ZmlsdGVyOiBgdXNlcl9pZD1lcS4ke3VzZXIuaWR9YFxuXHRcdFx0XHR9LCAocGF5bG9hZCkgPT4ge1xuXHRcdFx0XHRcdGNvbnN0IGN1cnJlbnRFeGVyY2lzZXMgPSBleGVyY2lzZXMkLmdldCgpO1xuXG5cdFx0XHRcdFx0aWYgKHBheWxvYWQuZXZlbnRUeXBlID09PSAnSU5TRVJUJykge1xuXHRcdFx0XHRcdFx0Y29uc3QgbmV3RXhlcmNpc2UgPSBwYXlsb2FkLm5ldyBhcyBFeGVyY2lzZTtcblx0XHRcdFx0XHRcdGlmIChuZXdFeGVyY2lzZS51c2VyX2lkID09PSB1c2VyLmlkKSB7XG5cdFx0XHRcdFx0XHRcdGV4ZXJjaXNlcyQucHVzaChuZXdFeGVyY2lzZSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSBlbHNlIGlmIChwYXlsb2FkLmV2ZW50VHlwZSA9PT0gJ0RFTEVURScpIHtcblx0XHRcdFx0XHRcdGNvbnN0IGRlbGV0ZWRFeGVyY2lzZSA9IHBheWxvYWQub2xkIGFzIEV4ZXJjaXNlO1xuXHRcdFx0XHRcdFx0Y29uc3QgaW5kZXhUb0RlbGV0ZSA9IGN1cnJlbnRFeGVyY2lzZXMuZmluZEluZGV4KGV4ID0+IGV4LmlkID09PSBkZWxldGVkRXhlcmNpc2UuaWQpO1xuXHRcdFx0XHRcdFx0aWYgKGluZGV4VG9EZWxldGUgIT09IC0xKSB7XG5cdFx0XHRcdFx0XHRcdGV4ZXJjaXNlcyQuc3BsaWNlKGluZGV4VG9EZWxldGUsIDEpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0gZWxzZSBpZiAocGF5bG9hZC5ldmVudFR5cGUgPT09ICdVUERBVEUnKSB7XG5cdFx0XHRcdFx0XHRjb25zdCB1cGRhdGVkRXhlcmNpc2UgPSBwYXlsb2FkLm5ldyBhcyBFeGVyY2lzZTtcblx0XHRcdFx0XHRcdGlmICh1cGRhdGVkRXhlcmNpc2UudXNlcl9pZCA9PT0gdXNlci5pZCkge1xuXHRcdFx0XHRcdFx0XHRjb25zdCBpbmRleFRvVXBkYXRlID0gY3VycmVudEV4ZXJjaXNlcy5maW5kSW5kZXgoZXggPT4gZXguaWQgPT09IHVwZGF0ZWRFeGVyY2lzZS5pZCk7XG5cdFx0XHRcdFx0XHRcdGlmIChpbmRleFRvVXBkYXRlICE9PSAtMSkge1xuXHRcdFx0XHRcdFx0XHRcdGV4ZXJjaXNlcyRbaW5kZXhUb1VwZGF0ZV0uc2V0KHVwZGF0ZWRFeGVyY2lzZSk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5zdWJzY3JpYmUoKTtcblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0Y29uc29sZS5lcnJvcignRmFpbGVkIHRvIHNldCB1cCByZWFsLXRpbWUgc3Vic2NyaXB0aW9uOicsIGVycm9yKTtcblx0XHR9XG5cdH07XG5cblx0Ly8gU2V0IHVwIGF1dGggc3RhdGUgbGlzdGVuZXIgdG8gcmVzdGFydCBzdWJzY3JpcHRpb24gd2hlbiB1c2VyIGNoYW5nZXNcblx0c3VwYWJhc2VDbGllbnQub25BdXRoU3RhdGVDaGFuZ2UoKGV2ZW50LCBzZXNzaW9uKSA9PiB7XG5cdFx0dXNlciQuc2V0KHNlc3Npb24/LnVzZXIgfHwgbnVsbCk7XG5cblx0XHQvLyBSZXN0YXJ0IHN1YnNjcmlwdGlvbiB3aGVuIHVzZXIgY2hhbmdlc1xuXHRcdGlmIChzdWJzY3JpcHRpb24pIHtcblx0XHRcdHN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuXHRcdFx0c3Vic2NyaXB0aW9uID0gbnVsbDtcblx0XHR9XG5cblx0XHRpZiAoc2Vzc2lvbj8udXNlcikge1xuXHRcdFx0c3RhcnRTdWJzY3JpcHRpb24oKTtcblx0XHRcdGxvYWRJbml0aWFsRGF0YSgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRleGVyY2lzZXMkLnNldChbXSk7XG5cdFx0fVxuXHR9KTtcbn1cblxuLyoqXG4gKiBTeW5jIGFuIGV4ZXJjaXNlIHRvIFN1cGFiYXNlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzeW5jRXhlcmNpc2VUb1N1cGFiYXNlKGV4ZXJjaXNlOiBFeGVyY2lzZSk6IFByb21pc2U8dm9pZD4ge1xuXHR0cnkge1xuXHRcdGNvbnN0IHVzZXIgPSBhd2FpdCBzdXBhYmFzZUNsaWVudC5nZXRDdXJyZW50VXNlcigpO1xuXHRcdGlmICghdXNlcikgdGhyb3cgbmV3IEVycm9yKCdVc2VyIG5vdCBhdXRoZW50aWNhdGVkJyk7XG5cblx0XHRjb25zdCBleGVyY2lzZVRvVXBzZXJ0OiBFeGVyY2lzZUluc2VydCA9IHtcblx0XHRcdGlkOiBleGVyY2lzZS5pZCxcblx0XHRcdG5hbWU6IGV4ZXJjaXNlLm5hbWUsXG5cdFx0XHR1c2VyX2lkOiBleGVyY2lzZS51c2VyX2lkLFxuXHRcdFx0Y3JlYXRlZF9hdDogZXhlcmNpc2UuY3JlYXRlZF9hdCxcblx0XHR9O1xuXG5cdFx0Y29uc3QgeyBlcnJvciB9ID0gYXdhaXQgKHN1cGFiYXNlQ2xpZW50LmdldFN1cGFiYXNlQ2xpZW50KCkuZnJvbSgnZXhlcmNpc2VzJykgYXMgYW55KVxuXHRcdFx0LnVwc2VydChleGVyY2lzZVRvVXBzZXJ0KTtcblx0XHRpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzeW5jIGV4ZXJjaXNlIHRvIFN1cGFiYXNlOicsIGVycm9yKTtcblx0XHR0aHJvdyBlcnJvcjtcblx0fVxufVxuXG4vKipcbiAqIERlbGV0ZSBhbiBleGVyY2lzZSBmcm9tIFN1cGFiYXNlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBkZWxldGVFeGVyY2lzZUZyb21TdXBhYmFzZShleGVyY2lzZUlkOiBzdHJpbmcsIHVzZXJJZDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG5cdHRyeSB7XG5cdFx0Y29uc3QgeyBlcnJvciB9ID0gYXdhaXQgKHN1cGFiYXNlQ2xpZW50LmdldFN1cGFiYXNlQ2xpZW50KCkuZnJvbSgnZXhlcmNpc2VzJykgYXMgYW55KVxuXHRcdFx0LmRlbGV0ZSgpXG5cdFx0XHQuZXEoJ2lkJywgZXhlcmNpc2VJZClcblx0XHRcdC5lcSgndXNlcl9pZCcsIHVzZXJJZCk7XG5cblx0XHRpZiAoZXJyb3IpIHRocm93IGVycm9yO1xuXHR9IGNhdGNoIChlcnJvcikge1xuXHRcdGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBkZWxldGUgZXhlcmNpc2UgZnJvbSBTdXBhYmFzZTonLCBlcnJvcik7XG5cdFx0dGhyb3cgZXJyb3I7XG5cdH1cbn1cblxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb25zIGZvciBzeW5jIG1hbmFnZW1lbnRcbiAqL1xuZXhwb3J0IGNvbnN0IHN5bmNIZWxwZXJzID0ge1xuXHQvKipcblx0ICogRm9yY2UgYSBtYW51YWwgc3luYyBvZiBleGVyY2lzZXNcblx0ICovXG5cdGFzeW5jIGZvcmNlU3luYygpOiBQcm9taXNlPHZvaWQ+IHtcblx0XHR0cnkge1xuXHRcdFx0Ly8gVHJpZ2dlciBhIG1hbnVhbCBzeW5jXG5cdFx0XHRjb25zdCB1c2VyID0gYXdhaXQgc3VwYWJhc2VDbGllbnQuZ2V0Q3VycmVudFVzZXIoKTtcblx0XHRcdGlmICghdXNlcikgcmV0dXJuO1xuXG5cdFx0XHRjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCAoc3VwYWJhc2VDbGllbnQuZ2V0U3VwYWJhc2VDbGllbnQoKS5mcm9tKCdleGVyY2lzZXMnKSBhcyBhbnkpXG5cdFx0XHRcdC5zZWxlY3QoJyonKVxuXHRcdFx0XHQuZXEoJ3VzZXJfaWQnLCB1c2VyLmlkKTtcblxuXHRcdFx0aWYgKCFlcnJvciAmJiBkYXRhKSB7XG5cdFx0XHRcdGV4ZXJjaXNlcyQuc2V0KGRhdGEpO1xuXHRcdFx0fVxuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gZm9yY2Ugc3luYzonLCBlcnJvcik7XG5cdFx0fVxuXHR9LFxuXG5cdC8qKlxuXHQgKiBDaGVjayBpZiB3ZSdyZSBjdXJyZW50bHkgc3luY2luZyAoc2ltcGxpZmllZCBmb3Igbm93KVxuXHQgKi9cblx0aXNTeW5jaW5nKCk6IGJvb2xlYW4ge1xuXHRcdC8vIFRoaXMgd291bGQgYmUgZW5oYW5jZWQgd2l0aCBhY3R1YWwgc3luYyBzdGF0ZSB0cmFja2luZ1xuXHRcdHJldHVybiBmYWxzZTtcblx0fSxcblxuXHQvKipcblx0ICogQ2hlY2sgb25saW5lIHN0YXR1cyB1c2luZyBicm93c2VyIG5hdmlnYXRvciBBUElcblx0ICovXG5cdGlzT25saW5lKCk6IGJvb2xlYW4ge1xuXHRcdC8vIFVzZSBicm93c2VyJ3MgbmF2aWdhdG9yLm9uTGluZSBmb3IgYmFzaWMgbmV0d29yayBkZXRlY3Rpb25cblx0XHQvLyBJbiBSZWFjdCBOYXRpdmUsIHRoaXMgd291bGQgdXNlIEByZWFjdC1uYXRpdmUtY29tbXVuaXR5L25ldGluZm9cblx0XHRpZiAodHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgJiYgJ29uTGluZScgaW4gbmF2aWdhdG9yKSB7XG5cdFx0XHRyZXR1cm4gbmF2aWdhdG9yLm9uTGluZTtcblx0XHR9XG5cdFx0Ly8gRmFsbGJhY2sgdG8gdHJ1ZSBmb3IgZW52aXJvbm1lbnRzIHdpdGhvdXQgbmF2aWdhdG9yXG5cdFx0cmV0dXJuIHRydWU7XG5cdH0sXG5cblx0LyoqXG5cdCAqIEdldCBwZW5kaW5nIGNoYW5nZXMgY291bnQgKHNpbXBsaWZpZWQpXG5cdCAqL1xuXHRnZXRQZW5kaW5nQ2hhbmdlc0NvdW50KCk6IG51bWJlciB7XG5cdFx0Ly8gVGhpcyB3b3VsZCB0cmFjayBhY3R1YWwgcGVuZGluZyBjaGFuZ2VzXG5cdFx0cmV0dXJuIDA7XG5cdH0sXG5cblx0LyoqXG5cdCAqIENoZWNrIGlmIHRoZXJlIGFyZSBzeW5jIGVycm9ycyAoc2ltcGxpZmllZClcblx0ICovXG5cdGhhc0Vycm9ycygpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH0sXG5cblx0LyoqXG5cdCAqIEdldCBjdXJyZW50IHN5bmMgZXJyb3IgbWVzc2FnZSAoc2ltcGxpZmllZClcblx0ICovXG5cdGdldEVycm9yTWVzc2FnZSgpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuXHRcdHJldHVybiB1bmRlZmluZWQ7XG5cdH0sXG59O1xuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSxJQUFBQSxlQUFBLEdBQUFDLE9BQUE7QUFDQSxJQUFBQyxNQUFBLEdBQUFELE9BQUE7QUFLQSxJQUFNRSxpQkFBaUIsR0FBRyxJQUFJO0FBQzlCLElBQU1DLGFBQWEsR0FBRyxLQUFLO0FBQzNCLElBQU1DLHVCQUF1QixHQUFHLElBQUk7QUFNN0IsU0FBU0MsbUJBQW1CQSxDQUFBLEVBQUc7RUFFckNDLGVBQWUsQ0FBQyxDQUFDO0VBQ2pCQyx5QkFBeUIsQ0FBQyxDQUFDO0FBQzVCO0FBQUMsU0FLY0QsZUFBZUEsQ0FBQTtFQUFBLE9BQUFFLGdCQUFBLENBQUFDLEtBQUEsT0FBQUMsU0FBQTtBQUFBO0FBQUEsU0FBQUYsaUJBQUE7RUFBQUEsZ0JBQUEsT0FBQUcsa0JBQUEsQ0FBQUMsT0FBQSxFQUE5QixhQUFpQztJQUNoQyxJQUFJO01BQ0gsSUFBTUMsSUFBSSxTQUFTQyw4QkFBYyxDQUFDQyxjQUFjLENBQUMsQ0FBQztNQUNsRCxJQUFJLENBQUNGLElBQUksRUFBRTtNQUVYLElBQUFHLGlCQUFBLFNBQStCRiw4QkFBYyxDQUFDRyxpQkFBaUIsQ0FBQyxDQUFDLENBQUNDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FDakZDLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FDWEMsRUFBRSxDQUFDLFNBQVMsRUFBRVAsSUFBSSxDQUFDUSxFQUFFLENBQUM7UUFGaEJDLElBQUksR0FBQU4saUJB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