appId: com.jimmysolutions.strengthassistant.test
---
# Test: Critical Bug - Exercises Lost After Airplane Mode
# Purpose: Reproduce the exact bug scenario on real device
# 
# Test Steps:
# 1. Turn on airplane mode
# 2. Add exercises while offline
# 3. Restore internet connectivity
# 4. Verify exercises sync to cloud
# 5. Restart app (critical step)
# 6. Verify exercises are NOT lost (this was failing before fix)

- launchApp

# Handle authentication - continue as guest
- assertVisible:
    text: "Continue as Guest"
- tapOn:
    id: "continue-as-guest"

# Navigate to exercises to add new exercises
- tapOn:
    id: "exercisesTab"
- assertVisible:
    id: "exercisesTab"

# STEP 1: Enable airplane mode (user must do this manually)
# Note: Maestro cannot control system settings like airplane mode
# User should enable airplane mode before running this test
- assertVisible:
    id: "exercisesTab"

# Wait a moment for airplane mode to take effect
- waitForAnimationToEnd

# STEP 2: Add exercises while offline
# Add first exercise
- tapOn:
    id: "add-exercise"
- assertVisible:
    text: "New Exercise"

- tapOn:
    id: "name"
- inputText: "Airplane Mode Push-ups"

- tapOn:
    id: "submit"

# Verify exercise appears in list (locally)
- assertVisible:
    text: "Airplane Mode Push-ups"

# Add second exercise
- tapOn:
    id: "add-exercise"
- assertVisible:
    text: "New Exercise"

- tapOn:
    id: "name"
- inputText: "Airplane Mode Squats"

- tapOn:
    id: "submit"

# Verify both exercises appear in list
- assertVisible:
    text: "Airplane Mode Push-ups"
- assertVisible:
    text: "Airplane Mode Squats"

# Check if sync status indicator shows offline/pending state
# This should be visible when app detects offline state
- assertVisible:
    id: "sync-status-indicator"

# STEP 3: User should now disable airplane mode manually
# Note: Include a pause for user to disable airplane mode
- tapOn:
    text: "Settings"
- assertVisible:
    text: "Disable airplane mode now, then tap Continue"
- tapOn:
    text: "Continue"

# Return to exercises
- tapOn:
    id: "exercisesTab"

# STEP 4: Wait for auto-sync to occur
# The app should automatically sync when connectivity is restored
- waitForAnimationToEnd

# Check sync status indicator should show syncing or synced
- assertVisible:
    id: "sync-status-indicator"

# Verify exercises are still visible locally
- assertVisible:
    text: "Airplane Mode Push-ups"
- assertVisible:
    text: "Airplane Mode Squats"

# STEP 5: CRITICAL - Restart the app
# This is where the bug occurred - exercises were lost on restart
- stopApp
- launchApp

# Wait for app to reload
- assertVisible:
    id: "workoutTab"

# Navigate back to exercises
- tapOn:
    id: "exercisesTab"
- assertVisible:
    id: "exercisesTab"

# STEP 6: CRITICAL ASSERTION - Exercises must NOT be lost
# This is the main test - if these assertions pass, the bug is fixed
- assertVisible:
    text: "Airplane Mode Push-ups"
- assertVisible:
    text: "Airplane Mode Squats"

# Additional verification: Check sync status is healthy
- assertVisible:
    id: "sync-status-indicator"

# Verify no error states are showing
- assertNotVisible:
    id: "maestro-error-blocker"

# Clean up: Remove the test exercises
- tapOn:
    text: "Airplane Mode Push-ups"
- assertVisible:
    text: "Exercise Details"
- tapOn:
    id: "delete-exercise-button"
- tapOn:
    text: "Delete"

- tapOn:
    id: "exercisesTab"
- tapOn:
    text: "Airplane Mode Squats"
- assertVisible:
    text: "Exercise Details"
- tapOn:
    id: "delete-exercise-button"
- tapOn:
    text: "Delete"

# Final verification: exercises are cleaned up
- tapOn:
    id: "exercisesTab"
- assertNotVisible:
    text: "Airplane Mode Push-ups"
- assertNotVisible:
    text: "Airplane Mode Squats"