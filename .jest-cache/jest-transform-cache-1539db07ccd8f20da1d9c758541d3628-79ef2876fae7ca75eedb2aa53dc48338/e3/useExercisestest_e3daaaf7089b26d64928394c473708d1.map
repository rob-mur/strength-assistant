{"version":3,"names":["_getJestObj","mock","observable","jest","fn","observe","computed","virtual","initializeFirebaseServices","getDb","supabaseClient","getCurrentUser","exercises$","get","set","user$","syncExerciseToSupabase","deleteExerciseFromSupabase","syncHelpers","isSyncing","isOnline","getPendingChangesCount","forceSync","hasErrors","getErrorMessage","ExerciseValidator","validateExerciseInput","sanitizeExerciseName","collection","addDoc","deleteDoc","doc","onSnapshot","query","orderBy","v4","logger","warn","debug","info","error","_interopRequireDefault","require","_asyncToGenerator2","_useAddExercise","_useExercises","_ExerciseRepo","_reactNative","_jestMockExtended","_logger","_require","mockRepo","describe","beforeEach","mockReset","mocked","ExerciseRepo","getInstance","mockReturnValue","test","default","testUid","subscribeToExercises","_renderHook","renderHook","exercises","useExercises","addExercise","useAddExercise","result","current","subscriptionCallback","calls","expect","toBe","act","id","name","user_id","created_at","waitFor","toEqual","_renderHook2","not","toHaveBeenCalled","toHaveBeenCalledWith","objectContaining","service","platform","operation","mockUnsubscribe","_renderHook3","unmount","any","Function"],"sources":["useExercises-test.tsx"],"sourcesContent":["import { useAddExercise } from \"@/lib/hooks/useAddExercise\";\nimport { useExercises } from \"@/lib/hooks/useExercises\";\nimport { ExerciseRepo } from \"@/lib/repo/ExerciseRepo\";\nimport { act, renderHook, waitFor } from \"@testing-library/react-native\";\nimport { mock, mockReset } from \"jest-mock-extended\";\nimport { logger } from \"@/lib/data/firebase/logger\";\n\n// Mock dependencies\njest.mock('@legendapp/state', () => ({\n  observable: jest.fn(),\n  observe: jest.fn(),\n  computed: jest.fn(),\n}), { virtual: true });\n\njest.mock('@/lib/data/firebase/initializer', () => ({\n  initializeFirebaseServices: jest.fn(),\n  getDb: jest.fn(),\n}));\n\njest.mock('@/lib/data/supabase/SupabaseClient', () => ({\n  supabaseClient: {\n    getCurrentUser: jest.fn(),\n  }\n}));\n\njest.mock('@/lib/data/store', () => ({\n  exercises$: {\n    get: jest.fn(),\n    set: jest.fn(),\n  },\n  user$: {\n    get: jest.fn(),\n  },\n}));\n\njest.mock('@/lib/data/sync/syncConfig', () => ({\n  syncExerciseToSupabase: jest.fn(),\n  deleteExerciseFromSupabase: jest.fn(),\n  syncHelpers: {\n    isSyncing: jest.fn(),\n    isOnline: jest.fn(),\n    getPendingChangesCount: jest.fn(),\n    forceSync: jest.fn(),\n    hasErrors: jest.fn(),\n    getErrorMessage: jest.fn(),\n  }\n}));\n\njest.mock('@/lib/models/Exercise', () => ({\n  ExerciseValidator: {\n    validateExerciseInput: jest.fn(),\n    sanitizeExerciseName: jest.fn(),\n  }\n}));\n\njest.mock('firebase/firestore', () => ({\n  collection: jest.fn(),\n  addDoc: jest.fn(),\n  deleteDoc: jest.fn(),\n  doc: jest.fn(),\n  onSnapshot: jest.fn(),\n  query: jest.fn(),\n  orderBy: jest.fn(),\n}));\n\njest.mock('uuid', () => ({\n  v4: jest.fn(() => 'test-uuid'),\n}));\n\njest.mock(\"@/lib/data/firebase\");\njest.mock(\"@/lib/repo/ExerciseRepo\");\njest.mock(\"@/lib/data/firebase/logger\", () => ({\n  logger: {\n    warn: jest.fn(),\n    debug: jest.fn(),\n    info: jest.fn(),\n    error: jest.fn(),\n  },\n}));\n\nconst mockRepo = mock<ExerciseRepo>();\n\ndescribe(\"useExercises\", () => {\n  beforeEach(() => {\n    mockReset(mockRepo);\n    jest.mocked(ExerciseRepo.getInstance).mockReturnValue(mockRepo);\n  });\n\n  test(\"adding an exercise refreshes the exercise list\", async () => {\n    const testUid = \"test-user-uid\";\n    \n    // Mock the subscription method\n    mockRepo.subscribeToExercises.mockReturnValue(jest.fn());\n\n    // Render both hooks together with UID\n    const { result } = renderHook(() => ({\n      exercises: useExercises(testUid),\n      addExercise: useAddExercise(testUid),\n    }));\n\n    // Add a new exercise\n    await result.current.addExercise(\"Push-ups\");\n\n    // Get the callback that was passed to subscribeToExercises\n    const subscriptionCallback = mockRepo.subscribeToExercises.mock.calls[0][1];\n\n    // Verify that the uid was passed correctly\n    expect(mockRepo.subscribeToExercises.mock.calls[0][0]).toBe(testUid);\n\n    // Simulate the repo calling back with updated exercise list\n    act(() => {\n      subscriptionCallback([\n        { id: \"1\", name: \"Squats\", user_id: testUid, created_at: \"2023-01-01T00:00:00Z\" }, \n        { id: \"2\", name: \"Push-ups\", user_id: testUid, created_at: \"2023-01-01T00:00:00Z\" }\n      ]);\n    });\n\n    // Verify the exercises list was updated\n    await waitFor(() => {\n      expect(result.current.exercises.exercises).toEqual([\n        { id: \"1\", name: \"Squats\", user_id: testUid, created_at: \"2023-01-01T00:00:00Z\" },\n        { id: \"2\", name: \"Push-ups\", user_id: testUid, created_at: \"2023-01-01T00:00:00Z\" },\n      ]);\n    });\n  });\n\n  test(\"handles unauthenticated user with warning\", () => {\n    const { result } = renderHook(() => useExercises(\"\"));\n\n    expect(result.current.exercises).toEqual([]);\n    expect(mockRepo.subscribeToExercises).not.toHaveBeenCalled();\n    expect(logger.warn).toHaveBeenCalledWith(\n      \"useExercises: User not authenticated, exercises will be empty\",\n      expect.objectContaining({\n        service: \"useExercises\",\n        platform: \"React Native\",\n        operation: \"fetch_exercises\"\n      })\n    );\n  });\n\n  test(\"cleans up subscription on unmount\", () => {\n    const testUid = \"test-user-uid\";\n    const mockUnsubscribe = jest.fn();\n    \n    mockRepo.subscribeToExercises.mockReturnValue(mockUnsubscribe);\n\n    const { unmount } = renderHook(() => useExercises(testUid));\n\n    expect(mockRepo.subscribeToExercises).toHaveBeenCalledWith(testUid, expect.any(Function));\n    \n    unmount();\n\n    expect(mockUnsubscribe).toHaveBeenCalled();\n  });\n});\n"],"mappings":"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","ignoreList":[]}