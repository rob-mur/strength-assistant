# Data Model: Production Server Testing Enhancement

**Feature**: 004-one-point-to  
**Context**: Simple APK-based production validation with minimal data requirements

## Core Entities

### 1. GitHub Actions Job Metadata

**Purpose**: Track production validation job execution
**Storage**: GitHub Actions native job data (no additional storage needed)

**Fields**:

- `jobId`: GitHub Actions job identifier
- `workflow`: "Production Validation"
- `status`: 'pending' | 'running' | 'success' | 'failure'
- `startTime`: GitHub Actions job start time
- `endTime`: GitHub Actions job end time
- `artifactPaths`: Screenshots and logs from Maestro execution

### 2. Maestro Flow Execution Results

**Purpose**: Results from individual test flow execution
**Storage**: GitHub Actions logs and artifacts (standard Maestro output)

**Fields**:

- `flowFileName`: string (e.g., "add-exercise-and-see-it-in-list.yml")
- `exitCode`: number (0 = success, non-zero = failure)
- `stdout`: string (Maestro execution output)
- `stderr`: string (error output if any)
- `duration`: number (execution time in milliseconds)
- `artifactPaths`: string[] (screenshots, debug output)

### 3. Parameterized GitHub Actions Configuration

**Purpose**: Configuration for reusable Android build and Maestro test actions
**Storage**: GitHub Actions composite action definitions

**Android Build Action Inputs**:

- `build-type`: 'preview' | 'production' (determines APK configuration)
- `devbox-config`: string (path to devbox configuration directory)
- `artifact-name`: string (name for output APK artifact)

**Maestro Test Action Inputs**:

- `apk-path`: string (path to APK artifact to test)
- `test-environment`: 'integration' | 'production' (test mode configuration)
- `skip-data-cleanup`: boolean (SKIP_DATA_CLEANUP environment variable)
- `devbox-config`: string (path to devbox test configuration)

### 4. Environment Configuration

**Purpose**: Runtime configuration for production validation execution
**Storage**: GitHub Actions workflow YAML file and environment variables

**Fields**:

- `SKIP_DATA_CLEANUP`: boolean (environment variable = true)
- `maestroFlowPaths`: string[] (paths to .maestro/\*.yml files)
- `apkBuildPath`: string (path to production APK artifact)
- `alertChannels`: Slack/email configuration for failure notifications

### 5. Anonymous Users (App-Managed)

**Purpose**: Temporary users created by app during test execution
**Storage**: Production database (temporary, self-expiring)

**Fields**:

- `userId`: Generated by app's standard anonymous user creation
- `isTestUser`: Automatically tagged during production validation runs
- `createdAt`: Standard app timestamp
- `expiresAt`: Standard app expiration (no special cleanup needed)

**Notes**:

- No additional data model changes required
- App already handles anonymous user lifecycle
- SKIP_DATA_CLEANUP=true prevents unnecessary cleanup operations

## Data Flow (Simplified)

### 1. Trigger

```
Terraform completes deployment → GitHub Actions workflow triggered
```

### 2. Execution

```
Build production APK → Set SKIP_DATA_CLEANUP=true → Run Maestro flows → Collect results
```

### 3. Results

```
All flows complete → Check exit codes → Send alerts if failed → Block/allow frontend deployment
```

## Storage Strategy

### Primary Storage

- **GitHub Actions**: Job metadata, logs, artifacts (built-in)
- **Production Database**: Anonymous users (existing app functionality)

### No Additional Storage Required

- No new databases or services
- No custom data persistence
- Leverages existing GitHub Actions and app infrastructure

## Configuration Files

### GitHub Actions Workflow

```yaml
# .github/workflows/production-validation.yml
# Contains job definition, APK build steps, Maestro execution, alerting
```

### Environment Variables

```
SKIP_DATA_CLEANUP=true  # Key modification for production context
```

**Data Model Status**: COMPLETE - Minimal data requirements for simple APK approach
