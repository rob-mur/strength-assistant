1473e7ba537180bd0998441532f42130
_getJestObj().mock("@/lib/data/supabase/supabase", function () {
  return {
    getSupabaseClient: jest.fn()
  };
});
var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));
var _SupabaseClient = require("@/lib/data/supabase/SupabaseClient");
var _supabase = require("@/lib/data/supabase/supabase");
function _getJestObj() {
  var _require = require("@jest/globals"),
    jest = _require.jest;
  _getJestObj = function _getJestObj() {
    return jest;
  };
  return jest;
}
describe("SupabaseClient", function () {
  var mockSupabaseClient = {
    from: jest.fn(),
    auth: {
      getUser: jest.fn(),
      onAuthStateChange: jest.fn(),
      signInAnonymously: jest.fn()
    }
  };
  beforeEach(function () {
    jest.clearAllMocks();
    _supabase.getSupabaseClient.mockReturnValue(mockSupabaseClient);
  });
  describe("constructor and client initialization", function () {
    test("creates instance without immediately calling getSupabaseClient", function () {
      var client = new _SupabaseClient.SupabaseClient();
      expect(_supabase.getSupabaseClient).not.toHaveBeenCalled();
      expect(client).toBeInstanceOf(_SupabaseClient.SupabaseClient);
    });
    test("lazy loads client on first access", function () {
      var client = new _SupabaseClient.SupabaseClient();
      client.exercises;
      expect(_supabase.getSupabaseClient).toHaveBeenCalledTimes(1);
    });
    test("reuses client on subsequent accesses", function () {
      var client = new _SupabaseClient.SupabaseClient();
      client.exercises;
      client.exercises;
      client.getSupabaseClient();
      expect(_supabase.getSupabaseClient).toHaveBeenCalledTimes(1);
    });
  });
  describe("getSupabaseClient", function () {
    test("returns the underlying Supabase client", function () {
      var client = new _SupabaseClient.SupabaseClient();
      var result = client.getSupabaseClient();
      expect(result).toBe(mockSupabaseClient);
      expect(_supabase.getSupabaseClient).toHaveBeenCalledTimes(1);
    });
    test("throws error when getSupabaseClient returns null", function () {
      _supabase.getSupabaseClient.mockReturnValue(null);
      var client = new _SupabaseClient.SupabaseClient();
      expect(function () {
        return client.getSupabaseClient();
      }).toThrow("Invalid Supabase client: missing required methods");
    });
    test("throws error when getSupabaseClient returns invalid client", function () {
      _supabase.getSupabaseClient.mockReturnValue({
        invalid: true
      });
      var client = new _SupabaseClient.SupabaseClient();
      expect(function () {
        return client.getSupabaseClient();
      }).toThrow("Invalid Supabase client: missing required methods");
    });
  });
  describe("exercises table access", function () {
    test("returns typed reference to exercises table", function () {
      var mockTableRef = {
        select: jest.fn(),
        insert: jest.fn()
      };
      mockSupabaseClient.from.mockReturnValue(mockTableRef);
      var client = new _SupabaseClient.SupabaseClient();
      var result = client.exercises;
      expect(mockSupabaseClient.from).toHaveBeenCalledWith('exercises');
      expect(result).toBe(mockTableRef);
    });
  });
  describe("getCurrentUser", function () {
    test("returns user when authenticated", (0, _asyncToGenerator2.default)(function* () {
      var mockUser = {
        id: "user-123",
        email: "test@example.com"
      };
      mockSupabaseClient.auth.getUser.mockResolvedValue({
        data: {
          user: mockUser
        },
        error: null
      });
      var client = new _SupabaseClient.SupabaseClient();
      var result = yield client.getCurrentUser();
      expect(result).toBe(mockUser);
      expect(mockSupabaseClient.auth.getUser).toHaveBeenCalledTimes(1);
    }));
    test("signs in anonymously when getUser fails", (0, _asyncToGenerator2.default)(function* () {
      var mockError = new Error("Auth error");
      var mockAnonUser = {
        id: "anon-123",
        email: null
      };
      mockSupabaseClient.auth.getUser.mockResolvedValue({
        data: {
          user: null
        },
        error: mockError
      });
      mockSupabaseClient.auth.signInAnonymously.mockResolvedValue({
        data: {
          user: mockAnonUser
        },
        error: null
      });
      var client = new _SupabaseClient.SupabaseClient();
      var result = yield client.getCurrentUser();
      expect(mockSupabaseClient.auth.signInAnonymously).toHaveBeenCalledTimes(1);
      expect(result).toBe(mockAnonUser);
    }));
    test("throws error when both getUser and signInAnonymously fail", (0, _asyncToGenerator2.default)(function* () {
      var mockError = new Error("Auth error");
      mockSupabaseClient.auth.getUser.mockResolvedValue({
        data: {
          user: null
        },
        error: mockError
      });
      mockSupabaseClient.auth.signInAnonymously.mockResolvedValue({
        data: {
          user: null
        },
        error: mockError
      });
      var client = new _SupabaseClient.SupabaseClient();
      yield expect(client.getCurrentUser()).rejects.toThrow("Auth error");
    }));
  });
  describe("onAuthStateChange", function () {
    test("sets up auth state change listener with proper types", function () {
      var mockCallback = jest.fn();
      var mockUnsubscribe = jest.fn();
      mockSupabaseClient.auth.onAuthStateChange.mockReturnValue(mockUnsubscribe);
      var client = new _SupabaseClient.SupabaseClient();
      var result = client.onAuthStateChange(mockCallback);
      expect(mockSupabaseClient.auth.onAuthStateChange).toHaveBeenCalledWith(mockCallback);
      expect(result).toBe(mockUnsubscribe);
    });
    test("callback receives properly typed parameters", function () {
      var mockCallback = jest.fn();
      var mockUnsubscribe = jest.fn();
      mockSupabaseClient.auth.onAuthStateChange.mockImplementation(function (callback) {
        callback('SIGNED_IN', {
          access_token: 'test',
          user: {
            id: 'user-123'
          }
        });
        return mockUnsubscribe;
      });
      var client = new _SupabaseClient.SupabaseClient();
      client.onAuthStateChange(mockCallback);
      expect(mockCallback).toHaveBeenCalledWith('SIGNED_IN', {
        access_token: 'test',
        user: {
          id: 'user-123'
        }
      });
    });
  });
  describe("singleton instance", function () {
    test("exports working singleton instance", function () {
      expect(_SupabaseClient.supabaseClient).toBeInstanceOf(_SupabaseClient.SupabaseClient);
    });
    test("singleton instance works correctly", function () {
      var mockTableRef = {
        select: jest.fn()
      };
      mockSupabaseClient.from.mockReturnValue(mockTableRef);
      var result = _SupabaseClient.supabaseClient.exercises;
      expect(mockSupabaseClient.from).toHaveBeenCalledWith('exercises');
      expect(result).toBe(mockTableRef);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZ2V0SmVzdE9iaiIsIm1vY2siLCJnZXRTdXBhYmFzZUNsaWVudCIsImplc3QiLCJmbiIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2FzeW5jVG9HZW5lcmF0b3IyIiwiX1N1cGFiYXNlQ2xpZW50IiwiX3N1cGFiYXNlIiwiX3JlcXVpcmUiLCJkZXNjcmliZSIsIm1vY2tTdXBhYmFzZUNsaWVudCIsImZyb20iLCJhdXRoIiwiZ2V0VXNlciIsIm9uQXV0aFN0YXRlQ2hhbmdlIiwic2lnbkluQW5vbnltb3VzbHkiLCJiZWZvcmVFYWNoIiwiY2xlYXJBbGxNb2NrcyIsIm1vY2tSZXR1cm5WYWx1ZSIsInRlc3QiLCJjbGllbnQiLCJTdXBhYmFzZUNsaWVudCIsImV4cGVjdCIsIm5vdCIsInRvSGF2ZUJlZW5DYWxsZWQiLCJ0b0JlSW5zdGFuY2VPZiIsImV4ZXJjaXNlcyIsInRvSGF2ZUJlZW5DYWxsZWRUaW1lcyIsInJlc3VsdCIsInRvQmUiLCJ0b1Rocm93IiwiaW52YWxpZCIsIm1vY2tUYWJsZVJlZiIsInNlbGVjdCIsImluc2VydCIsInRvSGF2ZUJlZW5DYWxsZWRXaXRoIiwiZGVmYXVsdCIsIm1vY2tVc2VyIiwiaWQiLCJlbWFpbCIsIm1vY2tSZXNvbHZlZFZhbHVlIiwiZGF0YSIsInVzZXIiLCJlcnJvciIsImdldEN1cnJlbnRVc2VyIiwibW9ja0Vycm9yIiwiRXJyb3IiLCJtb2NrQW5vblVzZXIiLCJyZWplY3RzIiwibW9ja0NhbGxiYWNrIiwibW9ja1Vuc3Vic2NyaWJlIiwibW9ja0ltcGxlbWVudGF0aW9uIiwiY2FsbGJhY2siLCJhY2Nlc3NfdG9rZW4iLCJzdXBhYmFzZUNsaWVudCJdLCJzb3VyY2VzIjpbIlN1cGFiYXNlQ2xpZW50LXRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU3VwYWJhc2VDbGllbnQsIHN1cGFiYXNlQ2xpZW50IH0gZnJvbSBcIkAvbGliL2RhdGEvc3VwYWJhc2UvU3VwYWJhc2VDbGllbnRcIjtcbmltcG9ydCB7IGdldFN1cGFiYXNlQ2xpZW50IH0gZnJvbSBcIkAvbGliL2RhdGEvc3VwYWJhc2Uvc3VwYWJhc2VcIjtcblxuLy8gTW9jayB0aGUgc3VwYWJhc2UgbW9kdWxlXG5qZXN0Lm1vY2soXCJAL2xpYi9kYXRhL3N1cGFiYXNlL3N1cGFiYXNlXCIsICgpID0+ICh7XG4gIGdldFN1cGFiYXNlQ2xpZW50OiBqZXN0LmZuKCksXG59KSk7XG5cbmRlc2NyaWJlKFwiU3VwYWJhc2VDbGllbnRcIiwgKCkgPT4ge1xuICBjb25zdCBtb2NrU3VwYWJhc2VDbGllbnQgPSB7XG4gICAgZnJvbTogamVzdC5mbigpLFxuICAgIGF1dGg6IHtcbiAgICAgIGdldFVzZXI6IGplc3QuZm4oKSxcbiAgICAgIG9uQXV0aFN0YXRlQ2hhbmdlOiBqZXN0LmZuKCksXG4gICAgICBzaWduSW5Bbm9ueW1vdXNseTogamVzdC5mbigpLFxuICAgIH0sXG4gIH07XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgKGdldFN1cGFiYXNlQ2xpZW50IGFzIGplc3QuTW9jaykubW9ja1JldHVyblZhbHVlKG1vY2tTdXBhYmFzZUNsaWVudCk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwiY29uc3RydWN0b3IgYW5kIGNsaWVudCBpbml0aWFsaXphdGlvblwiLCAoKSA9PiB7XG4gICAgdGVzdChcImNyZWF0ZXMgaW5zdGFuY2Ugd2l0aG91dCBpbW1lZGlhdGVseSBjYWxsaW5nIGdldFN1cGFiYXNlQ2xpZW50XCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBTdXBhYmFzZUNsaWVudCgpO1xuICAgICAgZXhwZWN0KGdldFN1cGFiYXNlQ2xpZW50KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgICAgZXhwZWN0KGNsaWVudCkudG9CZUluc3RhbmNlT2YoU3VwYWJhc2VDbGllbnQpO1xuICAgIH0pO1xuXG4gICAgdGVzdChcImxhenkgbG9hZHMgY2xpZW50IG9uIGZpcnN0IGFjY2Vzc1wiLCAoKSA9PiB7XG4gICAgICBjb25zdCBjbGllbnQgPSBuZXcgU3VwYWJhc2VDbGllbnQoKTtcbiAgICAgIFxuICAgICAgLy8gQWNjZXNzIGV4ZXJjaXNlcyB0byB0cmlnZ2VyIGNsaWVudCBpbml0aWFsaXphdGlvblxuICAgICAgY2xpZW50LmV4ZXJjaXNlcztcbiAgICAgIFxuICAgICAgZXhwZWN0KGdldFN1cGFiYXNlQ2xpZW50KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KFwicmV1c2VzIGNsaWVudCBvbiBzdWJzZXF1ZW50IGFjY2Vzc2VzXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBTdXBhYmFzZUNsaWVudCgpO1xuICAgICAgXG4gICAgICAvLyBBY2Nlc3MgbXVsdGlwbGUgdGltZXNcbiAgICAgIGNsaWVudC5leGVyY2lzZXM7XG4gICAgICBjbGllbnQuZXhlcmNpc2VzO1xuICAgICAgY2xpZW50LmdldFN1cGFiYXNlQ2xpZW50KCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChnZXRTdXBhYmFzZUNsaWVudCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcImdldFN1cGFiYXNlQ2xpZW50XCIsICgpID0+IHtcbiAgICB0ZXN0KFwicmV0dXJucyB0aGUgdW5kZXJseWluZyBTdXBhYmFzZSBjbGllbnRcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgY2xpZW50ID0gbmV3IFN1cGFiYXNlQ2xpZW50KCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBjbGllbnQuZ2V0U3VwYWJhc2VDbGllbnQoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShtb2NrU3VwYWJhc2VDbGllbnQpO1xuICAgICAgZXhwZWN0KGdldFN1cGFiYXNlQ2xpZW50KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KFwidGhyb3dzIGVycm9yIHdoZW4gZ2V0U3VwYWJhc2VDbGllbnQgcmV0dXJucyBudWxsXCIsICgpID0+IHtcbiAgICAgIChnZXRTdXBhYmFzZUNsaWVudCBhcyBqZXN0Lk1vY2spLm1vY2tSZXR1cm5WYWx1ZShudWxsKTtcbiAgICAgIFxuICAgICAgY29uc3QgY2xpZW50ID0gbmV3IFN1cGFiYXNlQ2xpZW50KCk7XG4gICAgICBcbiAgICAgIGV4cGVjdCgoKSA9PiBjbGllbnQuZ2V0U3VwYWJhc2VDbGllbnQoKSkudG9UaHJvdyhcbiAgICAgICAgXCJJbnZhbGlkIFN1cGFiYXNlIGNsaWVudDogbWlzc2luZyByZXF1aXJlZCBtZXRob2RzXCJcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KFwidGhyb3dzIGVycm9yIHdoZW4gZ2V0U3VwYWJhc2VDbGllbnQgcmV0dXJucyBpbnZhbGlkIGNsaWVudFwiLCAoKSA9PiB7XG4gICAgICAoZ2V0U3VwYWJhc2VDbGllbnQgYXMgamVzdC5Nb2NrKS5tb2NrUmV0dXJuVmFsdWUoeyBpbnZhbGlkOiB0cnVlIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBjbGllbnQgPSBuZXcgU3VwYWJhc2VDbGllbnQoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KCgpID0+IGNsaWVudC5nZXRTdXBhYmFzZUNsaWVudCgpKS50b1Rocm93KFxuICAgICAgICBcIkludmFsaWQgU3VwYWJhc2UgY2xpZW50OiBtaXNzaW5nIHJlcXVpcmVkIG1ldGhvZHNcIlxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJleGVyY2lzZXMgdGFibGUgYWNjZXNzXCIsICgpID0+IHtcbiAgICB0ZXN0KFwicmV0dXJucyB0eXBlZCByZWZlcmVuY2UgdG8gZXhlcmNpc2VzIHRhYmxlXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tUYWJsZVJlZiA9IHsgc2VsZWN0OiBqZXN0LmZuKCksIGluc2VydDogamVzdC5mbigpIH07XG4gICAgICBtb2NrU3VwYWJhc2VDbGllbnQuZnJvbS5tb2NrUmV0dXJuVmFsdWUobW9ja1RhYmxlUmVmKTtcbiAgICAgIFxuICAgICAgY29uc3QgY2xpZW50ID0gbmV3IFN1cGFiYXNlQ2xpZW50KCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBjbGllbnQuZXhlcmNpc2VzO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja1N1cGFiYXNlQ2xpZW50LmZyb20pLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdleGVyY2lzZXMnKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUobW9ja1RhYmxlUmVmKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJnZXRDdXJyZW50VXNlclwiLCAoKSA9PiB7XG4gICAgdGVzdChcInJldHVybnMgdXNlciB3aGVuIGF1dGhlbnRpY2F0ZWRcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1VzZXIgPSB7IGlkOiBcInVzZXItMTIzXCIsIGVtYWlsOiBcInRlc3RAZXhhbXBsZS5jb21cIiB9O1xuICAgICAgbW9ja1N1cGFiYXNlQ2xpZW50LmF1dGguZ2V0VXNlci5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGE6IHsgdXNlcjogbW9ja1VzZXIgfSxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgY2xpZW50ID0gbmV3IFN1cGFiYXNlQ2xpZW50KCk7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBjbGllbnQuZ2V0Q3VycmVudFVzZXIoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZShtb2NrVXNlcik7XG4gICAgICBleHBlY3QobW9ja1N1cGFiYXNlQ2xpZW50LmF1dGguZ2V0VXNlcikudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgIH0pO1xuXG4gICAgdGVzdChcInNpZ25zIGluIGFub255bW91c2x5IHdoZW4gZ2V0VXNlciBmYWlsc1wiLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRXJyb3IgPSBuZXcgRXJyb3IoXCJBdXRoIGVycm9yXCIpO1xuICAgICAgY29uc3QgbW9ja0Fub25Vc2VyID0geyBpZDogXCJhbm9uLTEyM1wiLCBlbWFpbDogbnVsbCB9O1xuICAgICAgXG4gICAgICBtb2NrU3VwYWJhc2VDbGllbnQuYXV0aC5nZXRVc2VyLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZGF0YTogeyB1c2VyOiBudWxsIH0sXG4gICAgICAgIGVycm9yOiBtb2NrRXJyb3IsXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgbW9ja1N1cGFiYXNlQ2xpZW50LmF1dGguc2lnbkluQW5vbnltb3VzbHkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgICBkYXRhOiB7IHVzZXI6IG1vY2tBbm9uVXNlciB9LFxuICAgICAgICBlcnJvcjogbnVsbCxcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBjbGllbnQgPSBuZXcgU3VwYWJhc2VDbGllbnQoKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsaWVudC5nZXRDdXJyZW50VXNlcigpO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja1N1cGFiYXNlQ2xpZW50LmF1dGguc2lnbkluQW5vbnltb3VzbHkpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUobW9ja0Fub25Vc2VyKTtcbiAgICB9KTtcblxuICAgIHRlc3QoXCJ0aHJvd3MgZXJyb3Igd2hlbiBib3RoIGdldFVzZXIgYW5kIHNpZ25JbkFub255bW91c2x5IGZhaWxcIiwgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0Vycm9yID0gbmV3IEVycm9yKFwiQXV0aCBlcnJvclwiKTtcbiAgICAgIFxuICAgICAgbW9ja1N1cGFiYXNlQ2xpZW50LmF1dGguZ2V0VXNlci5tb2NrUmVzb2x2ZWRWYWx1ZSh7XG4gICAgICAgIGRhdGE6IHsgdXNlcjogbnVsbCB9LFxuICAgICAgICBlcnJvcjogbW9ja0Vycm9yLFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIG1vY2tTdXBhYmFzZUNsaWVudC5hdXRoLnNpZ25JbkFub255bW91c2x5Lm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgICAgZGF0YTogeyB1c2VyOiBudWxsIH0sXG4gICAgICAgIGVycm9yOiBtb2NrRXJyb3IsXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgY2xpZW50ID0gbmV3IFN1cGFiYXNlQ2xpZW50KCk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdChjbGllbnQuZ2V0Q3VycmVudFVzZXIoKSkucmVqZWN0cy50b1Rocm93KFwiQXV0aCBlcnJvclwiKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJvbkF1dGhTdGF0ZUNoYW5nZVwiLCAoKSA9PiB7XG4gICAgdGVzdChcInNldHMgdXAgYXV0aCBzdGF0ZSBjaGFuZ2UgbGlzdGVuZXIgd2l0aCBwcm9wZXIgdHlwZXNcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0NhbGxiYWNrID0gamVzdC5mbigpO1xuICAgICAgY29uc3QgbW9ja1Vuc3Vic2NyaWJlID0gamVzdC5mbigpO1xuICAgICAgbW9ja1N1cGFiYXNlQ2xpZW50LmF1dGgub25BdXRoU3RhdGVDaGFuZ2UubW9ja1JldHVyblZhbHVlKG1vY2tVbnN1YnNjcmliZSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGNsaWVudCA9IG5ldyBTdXBhYmFzZUNsaWVudCgpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gY2xpZW50Lm9uQXV0aFN0YXRlQ2hhbmdlKG1vY2tDYWxsYmFjayk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrU3VwYWJhc2VDbGllbnQuYXV0aC5vbkF1dGhTdGF0ZUNoYW5nZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgobW9ja0NhbGxiYWNrKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUobW9ja1Vuc3Vic2NyaWJlKTtcbiAgICB9KTtcblxuICAgIHRlc3QoXCJjYWxsYmFjayByZWNlaXZlcyBwcm9wZXJseSB0eXBlZCBwYXJhbWV0ZXJzXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tDYWxsYmFjayA9IGplc3QuZm4oKTtcbiAgICAgIGNvbnN0IG1vY2tVbnN1YnNjcmliZSA9IGplc3QuZm4oKTtcbiAgICAgIFxuICAgICAgbW9ja1N1cGFiYXNlQ2xpZW50LmF1dGgub25BdXRoU3RhdGVDaGFuZ2UubW9ja0ltcGxlbWVudGF0aW9uKChjYWxsYmFjaykgPT4ge1xuICAgICAgICAvLyBTaW11bGF0ZSBhdXRoIHN0YXRlIGNoYW5nZSB3aXRoIHByb3Blcmx5IHR5cGVkIHBhcmFtZXRlcnNcbiAgICAgICAgY2FsbGJhY2soJ1NJR05FRF9JTicsIHsgYWNjZXNzX3Rva2VuOiAndGVzdCcsIHVzZXI6IHsgaWQ6ICd1c2VyLTEyMycgfSB9KTtcbiAgICAgICAgcmV0dXJuIG1vY2tVbnN1YnNjcmliZTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBjbGllbnQgPSBuZXcgU3VwYWJhc2VDbGllbnQoKTtcbiAgICAgIGNsaWVudC5vbkF1dGhTdGF0ZUNoYW5nZShtb2NrQ2FsbGJhY2spO1xuICAgICAgXG4gICAgICBleHBlY3QobW9ja0NhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJ1NJR05FRF9JTicsIFxuICAgICAgICB7IGFjY2Vzc190b2tlbjogJ3Rlc3QnLCB1c2VyOiB7IGlkOiAndXNlci0xMjMnIH0gfVxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJzaW5nbGV0b24gaW5zdGFuY2VcIiwgKCkgPT4ge1xuICAgIHRlc3QoXCJleHBvcnRzIHdvcmtpbmcgc2luZ2xldG9uIGluc3RhbmNlXCIsICgpID0+IHtcbiAgICAgIGV4cGVjdChzdXBhYmFzZUNsaWVudCkudG9CZUluc3RhbmNlT2YoU3VwYWJhc2VDbGllbnQpO1xuICAgIH0pO1xuXG4gICAgdGVzdChcInNpbmdsZXRvbiBpbnN0YW5jZSB3b3JrcyBjb3JyZWN0bHlcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1RhYmxlUmVmID0geyBzZWxlY3Q6IGplc3QuZm4oKSB9O1xuICAgICAgbW9ja1N1cGFiYXNlQ2xpZW50LmZyb20ubW9ja1JldHVyblZhbHVlKG1vY2tUYWJsZVJlZik7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHN1cGFiYXNlQ2xpZW50LmV4ZXJjaXNlcztcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tTdXBhYmFzZUNsaWVudC5mcm9tKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnZXhlcmNpc2VzJyk7XG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKG1vY2tUYWJsZVJlZik7XG4gICAgfSk7XG4gIH0pO1xufSk7Il0sIm1hcHBpbmdzIjoiQUFJQUEsV0FBQSxHQUFLQyxJQUFJLENBQUMsOEJBQThCLEVBQUU7RUFBQSxPQUFPO0lBQy9DQyxpQkFBaUIsRUFBRUMsSUFBSSxDQUFDQyxFQUFFLENBQUM7RUFDN0IsQ0FBQztBQUFBLENBQUMsQ0FBQztBQUFDLElBQUFDLHNCQUFBLEdBQUFDLE9BQUE7QUFBQSxJQUFBQyxrQkFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBTkosSUFBQUUsZUFBQSxHQUFBRixPQUFBO0FBQ0EsSUFBQUcsU0FBQSxHQUFBSCxPQUFBO0FBQWlFLFNBQUFOLFlBQUE7RUFBQSxJQUFBVSxRQUFBLEdBQUFKLE9BQUE7SUFBQUgsSUFBQSxHQUFBTyxRQUFBLENBQUFQLElBQUE7RUFBQUgsV0FBQSxZQUFBQSxZQUFBO0lBQUEsT0FBQUcsSUFBQTtFQUFBO0VBQUEsT0FBQUEsSUFBQTtBQUFBO0FBT2pFUSxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsWUFBTTtFQUMvQixJQUFNQyxrQkFBa0IsR0FBRztJQUN6QkMsSUFBSSxFQUFFVixJQUFJLENBQUNDLEVBQUUsQ0FBQyxDQUFDO0lBQ2ZVLElBQUksRUFBRTtNQUNKQyxPQUFPLEVBQUVaLElBQUksQ0FBQ0MsRUFBRSxDQUFDLENBQUM7TUFDbEJZLGlCQUFpQixFQUFFYixJQUFJLENBQUNDLEVBQUUsQ0FBQyxD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